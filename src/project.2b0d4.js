window.__require=function e(t,n,o){function i(r,s){if(!n[r]){if(!t[r]){var l=r.split("/");if(l=l[l.length-1],!t[l]){var c="function"==typeof __require&&__require;if(!s&&c)return c(l,!0);if(a)return a(l,!0);throw new Error("Cannot find module '"+r+"'")}}var p=n[r]={exports:{}};t[r][0].call(p.exports,function(e){return i(t[r][1][e]||e)},p,p.exports,e,t,n,o)}return n[r].exports}for(var a="function"==typeof __require&&__require,r=0;r<o.length;r++)i(o[r]);return i}({AudioController:[function(e,t,n){"use strict";cc._RF.push(t,"6bfadvomfpBW76yybhNYu6p","AudioController"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Utils/HashMap"),i=e("../Event/EventManager"),a=e("../Event/EventName"),r=e("../Game/Game"),s=e("../table"),l=e("../Config/Config"),c=function(){function e(){this.clips=new o.HashMap,this.bgmAudioID=-1,this.curBgmName="",this.rocketMoveAudioID=-1}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){var t=this;cc.loader.loadResDir("sounds",cc.AudioClip,function(n,o,i){if(n)console.error(n);else{for(var a=0,r=o;a<r.length;a++){var s=r[a];t.clips.add(s.name,s)}t.initEvent(),t.play("Normal_BGM",!0),e&&e()}})},e.prototype.initEvent=function(){var e=this;i.gEventMgr.targetOff(this),i.gEventMgr.on(a.GlobalEvent.JUMP,function(t){e.play(t+"-jump",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.MONSTER_ATTACK,function(t){var n=t.split("-")[1];e.play(n+"-attack",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.MONSTER_ADD,function(t){e.play(t+"-attack",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.MONSTER_ATTACK_DONE,function(){e.play("boom",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.PRE_SELECT_BALL,function(t){e.play(t+"-ready",!1,1),e.play("change_tab",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.CHANGE_CUR_BALL,function(t){t?e.rocketMoveAudioID=e.play(t.BallID+"-move",!0,1):(-1!=e.rocketMoveAudioID&&e.stop("2002-move",e.rocketMoveAudioID),e.rocketMoveAudioID=-1)},this),i.gEventMgr.on(a.GlobalEvent.UPDATE_BALL_ITEM_NUMBER,function(t){e.play(t+"-boom",!1,1)}),i.gEventMgr.on(a.GlobalEvent.ADD_EFFECT,function(t,n,o){switch(t){case l.EffectType.Boom:e.play("2002-boom",!1,1)}},this),i.gEventMgr.on(a.GlobalEvent.BALL_HIT,function(){e.play("ball_hit",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.MAINUI_TOUCH,function(){e.play("UI_click",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.BOSS_ZAI_STEP,function(t){e.play("1017-step"+t,!1)}),i.gEventMgr.on(a.GlobalEvent.BOSS_WARNING,function(){e.play("warnning",!1,1)},this),i.gEventMgr.on(a.GlobalEvent.ITEM_USE,function(t,n,o){switch(e.play("item-"+n,!1,1),t){case s.Monster_ball_prop_form.HuiFuNaiJiuDu:case s.Monster_ball_prop_form.JiaFenShu:case s.Monster_ball_prop_form.QuanBuGuaiWuTingDun:break;case s.Monster_ball_prop_form.QuanPingGongJiGuaiWu:e.play("plane_queue",!1)}}),i.gEventMgr.on(a.GlobalEvent.CHANGE_GAME_SCENE,function(){var t=r.Game.levelStaticInfo.form==s.Monster_ball_paly_level_form.BOSSGuan?"Boss_BGM":"Normal_BGM";t!=e.curBgmName&&(-1!=e.bgmAudioID&&e.stop(e.curBgmName,e.bgmAudioID),e.bgmAudioID=e.play(t,!0,.7),e.curBgmName=t)},this)},e.prototype.stop=function(t,n){if(e.canPlay)cc.audioEngine.stop(n);else for(var o=0,i=e.PlayedList;o<i.length;o++){var a=i[o];a.skip=a.clipName==t}},e.prototype.play=function(t,n,o){if(void 0===o&&(o=1),!e.canPlay&&!e.hasBindTouch){e.hasBindTouch=!0;var i=this,a=function(){var t;for(cc.game.canvas.removeEventListener("touchstart",a),e.canPlay=!0;(t=e.PlayedList.pop())&&i.clips.get(t.clipName)&&!t.skip;){var n=cc.audioEngine.play(i.clips.get(t.clipName),t.loop,t.volume);cc.audioEngine.setCurrentTime(n,(Date.now()-t.supTime)/1e3)}};cc.game.canvas.addEventListener("touchstart",a)}return this.clips.get(t)?e.canPlay?cc.audioEngine.play(this.clips.get(t),n,o):(e.PlayedList.push({clipName:t,loop:n,volume:o,supTime:Date.now(),skip:!1}),-2):-1},e.PlayedList=[],e.canPlay=cc.sys.os.toLowerCase()!=cc.sys.OS_IOS.toLowerCase(),e.hasBindTouch=!1,e}();n.gAudio=c.inst,cc._RF.pop()},{"../Config/Config":"Config","../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Game":"Game","../Utils/HashMap":"HashMap","../table":"table"}],Background:[function(e,t,n){"use strict";cc._RF.push(t,"6e6c977y+ZNJ5vXdpMVKfjC","Background"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Event/EventManager"),i=e("../Event/EventName"),a=cc._decorator,r=a.ccclass,s=(a.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sceneID=0,t.isBroken=!1,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.start=function(){},Object.defineProperty(t.prototype,"animation",{get:function(){return this.ani?this.ani:this.ani=this.getComponent(cc.Animation)},enumerable:!0,configurable:!0}),t.prototype.reuse=function(){this.sceneID=arguments[0][0],this.initEvent(),this.isBroken=!1},t.prototype.unuse=function(){this.sceneID=0,this.offEvent()},t.prototype.sceneBroken=function(e){0!=this.sceneID&&(e>.5?this.isBroken&&(this.isBroken=!1,this.animation.play("recover")):this.isBroken||(this.isBroken=!0,this.animation.play("broken")))},t.prototype.initEvent=function(){o.gEventMgr.on(i.GlobalEvent.UPDATE_SCENE_HP_PROGRESS,this.sceneBroken,this),o.gEventMgr.on(i.GlobalEvent.CHANGE_SCENE_DONE,this.reset,this)},t.prototype.reset=function(){console.log(" back ground reset!!!!!!!"),this.isBroken=!1;var e=this.animation.getAnimationState("recover");this.animation.play("recover",e.duration)},t.prototype.offEvent=function(){o.gEventMgr.targetOff(this)},t=__decorate([r],t)}(cc.Component));n.default=s,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName"}],BallCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"cbde4kdX39M2qMC/gDXEsJg","BallCtrl"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Event/EventName"),i=e("../Config/Config"),a=e("../Game/Game"),r=e("../table"),s=e("../Event/EventManager"),l=cc._decorator,c=l.ccclass,p=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.reuse=function(){this.initEvent(),this.collider=this.getComponent(cc.PhysicsCircleCollider),this.updateBallID(arguments[0][0],arguments[0][1],arguments[0][2])},t.prototype.unuse=function(){this.offEvent(),this.ballID=this.ball=null},t.prototype.initEvent=function(){s.gEventMgr.on(o.GlobalEvent.JUMP,this.jump.bind(this),this)},t.prototype.offEvent=function(){s.gEventMgr.targetOff(this)},t.prototype.jump=function(e,t){this.ball&&this.ball.Form!=r.Monster_ball_ball_form.ZhaDan&&(this.node.y>cc.winSize.height||(t==i.JUMP_DIR.LEFT?(this.angularVelocity=-i.PhysicConf.angularVelocity,this.linearVelocity=i.PhysicConf.linearVelocity.neg()):(this.linearVelocity=i.PhysicConf.linearVelocity,this.angularVelocity=i.PhysicConf.angularVelocity),this.applyForceToCenter(i.PhysicConf.applyForce.mul(this.collider.density*Math.PI*this.collider.radius*this.collider.radius),!0)))},t.prototype.updateBallID=function(e,t,n){if(this.ballID=e,this.ball=t,n&&this.node.setRotation(n),this.ball.Form==r.Monster_ball_ball_form.ZhaDan){var o=Math.abs(this.node.rotation*Math.PI/180);this.linearVelocity=cc.v2(800*-Math.abs(Math.sin(o)),800*Math.abs(Math.cos(o)))}},t.prototype.onBeginContact=function(e,t,n){this.ball&&this.ball.Form==r.Monster_ball_ball_form.ZhaDan?(console.log("\u706b\u7bad\u7206\u70b8"),s.gEventMgr.emit(o.GlobalEvent.ADD_EFFECT,i.EffectType.Boom,e.getWorldManifold().points[0],!0)):s.gEventMgr.emit(o.GlobalEvent.BALL_HIT),n.node.group==i.Group.Weakness?(console.log("\u653b\u51fb\u5f31\u70b9"),a.Game.ballAttack(this.ballID,n.node.name)):this.ball&&this.ball.Form==r.Monster_ball_ball_form.ZhaDan&&a.Game.ballCost(this.ballID)},t=__decorate([c],t)}(cc.RigidBody));n.default=p,cc._RF.pop()},{"../Config/Config":"Config","../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Game":"Game","../table":"table"}],BallTab:[function(e,t,n){"use strict";cc._RF.push(t,"9354f2hBvpIz6dPHa99KtaZ","BallTab"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Game/Game"),i=e("../TableMgr"),a=e("../table"),r=e("../Event/EventName"),s=e("../Event/EventManager"),l=e("../Controller/CameraController"),c=cc._decorator,p=c.ccclass,h=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BallIcon=null,t.LifeTimeSprite=null,t.Button=null,t.MainUI=null,t.LifeTime=null,t.BallSelectRange=null,t.RocketRange=null,t.isReady=!1,t.initZIndex=0,t}return __extends(t,e),t.prototype.onLoad=function(){this.reset(),this.initZIndex=this.node.zIndex},t.prototype.reset=function(){this.Button.interactable=!1,this.Button.enabled=!1,this.LifeTimeSprite.enabled=!1,this.BallIcon.node.getChildByName("array").active=!1,this.BallIcon.enabled=!1,this.BallIcon.node.color=cc.Color.WHITE,this.ballIconInitPos=this.BallIcon.node.getPosition(),this.BallIcon.node.setScale(.75),this.lifeTotal=this.LifeTimeSprite.node.height,this.RocketRange.enabled=!1,this.isReady=!1},t.prototype.initEvent=function(){var e=this;this.Button.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.Button.node.on(cc.Node.EventType.TOUCH_END,this.onTouchCancel,this),this.Button.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.Button.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchCancel,this),s.gEventMgr.on(r.GlobalEvent.CUR_BALL_UPDATE,this.changeCurBall,this),s.gEventMgr.on(r.GlobalEvent.UPDATE_BALL_LIFE,this.updateBallLife,this),s.gEventMgr.on(r.GlobalEvent.GEN_NEXT_LEVEL,this.reset,this),s.gEventMgr.on(r.GlobalEvent.PRE_SELECT_BALL,function(t){e.ballInfo.ID!=t&&(e.LifeTimeSprite.enabled=!1,e.BallIcon.node.setScale(.75))},this)},t.prototype.offEvent=function(){this.Button.node.targetOff(this),s.gEventMgr.targetOff(this)},t.prototype.start=function(){},t.prototype.preSelect=function(){this.Button.interactable=!0,this.LifeTimeSprite.enabled=!0,s.gEventMgr.emit(r.GlobalEvent.PRE_SELECT_BALL,this.ballInfo.ID)},t.prototype.onTouchStart=function(e){!this.Button.enabled||o.Game.getBallNumber(this.ballInfo.ID)<=0||(this.preSelect(),this.node.zIndex=cc.macro.MAX_ZINDEX)},t.prototype.onTouchMove=function(e){if(this.Button.interactable){var t=this.node.convertToNodeSpaceAR(e.getLocation()),n=this.RocketRange.node.convertToNodeSpaceAR(e.getLocation());n.x=Math.abs(n.x);var o=this.BallSelectRange.convertToNodeSpaceAR(e.getLocation()),i=this.BallSelectRange.width>=o.x&&o.x>=0&&this.BallSelectRange.height>=o.y&&o.y>=0,r=this.RocketRange.node.width>=n.x&&n.x>=0&&this.RocketRange.node.height>=n.y&&n.y>=0;if(i||(this.isReady=!0),(r||this.ballInfo.form!=a.Monster_ball_ball_form.ZhaDan)&&(!this.isReady||!i||this.ballInfo.form==a.Monster_ball_ball_form.ZhaDan)&&(o.y>=100*cc.Camera.main.zoomRatio||this.ballInfo.form==a.Monster_ball_ball_form.ZhaDan)){if(this.ballInfo.form==a.Monster_ball_ball_form.ZhaDan&&this.isReady){var s=this.RocketRange.node.width,c=Math.atan2(n.y,n.x)-Math.PI/2;t.x=Math.sin(c)*s,t.y=Math.cos(c)*s,t=this.RocketRange.node.convertToWorldSpaceAR(t),t=this.node.convertToNodeSpaceAR(t)}this.BallIcon.node.setPosition(t)}if(this.BallIcon.node.setScale(1.2),this.ballInfo.form==a.Monster_ball_ball_form.ZhaDan){if(r&&this.isReady){this.BallIcon.node.getChildByName("array").active=!0,this.isReady=!0,l.gCamera.canZoomOut=!1,l.gCamera.readyRocket(!0),(n=this.RocketRange.node.convertToNodeSpaceAR(this.node.convertToWorldSpaceAR(t))).x=Math.abs(n.x);c=Math.atan2(n.y,n.x)-Math.PI/2;this.BallIcon.node.rotation=c/Math.PI*180+this.BallIcon.node.parent.rotation}this.RocketRange.enabled=!0}else this.BallIcon.node.getChildByName("array").active=!1}},t.prototype.resetState=function(){this.isReady=!1,this.BallIcon.node.scale=.75,this.BallIcon.node.rotation=0,this.BallIcon.node.getChildByName("array").active=!1,this.BallIcon.node.setPosition(this.ballIconInitPos),this.Button.interactable=!1,this.node.zIndex=this.initZIndex,this.ballInfo.form==a.Monster_ball_ball_form.ZhaDan&&(this.RocketRange.enabled=!1)},t.prototype.onTouchCancel=function(e){if(this.Button.interactable)if(l.gCamera.canZoomOut=!0,this.isReady){var t=this.node.convertToWorldSpaceAR(this.BallIcon.node.position).scaleSelf(cc.v2(1/cc.Camera.main.zoomRatio,1/cc.Camera.main.zoomRatio));(t=this.MainUI.parent.convertToNodeSpaceAR(t)).x-=cc.Camera.main.zoomRatio>.51?0:cc.winSize.width/2,o.Game.changeCurBall(this.ballInfo.ID,t,this.BallIcon.node.rotation),this.resetState()}else this.resetState()},t.prototype.updateBallNumber=function(){console.log("id:"+this.ballInfo.ID+",update Ball number:"+o.Game.getBallNumber(this.ballInfo.ID));var e=o.Game.getBallNumber(this.ballInfo.ID);this.BallIcon.node.color=e>0?cc.Color.WHITE:cc.Color.RED,e<=0&&s.gEventMgr.emit(r.GlobalEvent.PRE_SELECT_BALL,null)},t.prototype.updateBallLife=function(e){this.LifeTime.height=this.lifeTotal*e},t.prototype.changeCurBall=function(e,t){this.Button.interactable=!1,this.LifeTime.height=this.lifeTotal,e?(this.Button.enabled=!0,this.updateBallNumber()):(this.LifeTimeSprite.enabled=t==this.ballInfo.ID,this.Button.enabled=!1,this.ballInfo.ID!=t&&this.BallIcon.node.setScale(.75),this.BallIcon.node.color=o.Game.getBallNumber(this.ballInfo.ID)>0?cc.Color.WHITE:cc.Color.RED)},t.prototype.updateBallInfo=function(e,t){this.ballInfo=i.TableMgr.inst.getMonster_ball_ball(e),this.ballInfo?this.initEvent():this.offEvent();var n=this.BallIcon,o=this.Button;cc.loader.loadRes("Texture/ball/"+e,cc.SpriteFrame,function(e,i){e?console.error(e):(n.enabled=!0,o.enabled=!0,n.spriteFrame=i,t&&t())})},__decorate([h(cc.Sprite)],t.prototype,"BallIcon",void 0),__decorate([h(cc.Sprite)],t.prototype,"LifeTimeSprite",void 0),__decorate([h(cc.Button)],t.prototype,"Button",void 0),__decorate([h(cc.Node)],t.prototype,"MainUI",void 0),__decorate([h(cc.Node)],t.prototype,"LifeTime",void 0),__decorate([h(cc.Node)],t.prototype,"BallSelectRange",void 0),__decorate([h(cc.Sprite)],t.prototype,"RocketRange",void 0),t=__decorate([p],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../Controller/CameraController":"CameraController","../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Game":"Game","../TableMgr":"TableMgr","../table":"table"}],Ball:[function(e,t,n){"use strict";cc._RF.push(t,"a1f57YRG6xFoKerGym3BE8x","Ball"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../table"),i=e("../TableMgr"),a=e("./Game"),r=e("./BuffManager"),s=e("../Event/EventName"),l=e("../Event/EventManager"),c=function(){function e(e){this.enableLifeTime=!1,this.ballID=e;var t=i.TableMgr.inst.getMonster_ball_ball(this.ballID);this.form=t.form,this.continue=t.continue,this.lifeTime=t.lifetime,this.enableLifeTime=this.lifeTime>0,this.attack=t.attack,this.durable=t.durable,this.totalDurable=t.durable,this.totalLife=t.lifetime,this.combo=t.combo,this.buff=new r.BuffManager(this.ballID)}return Object.defineProperty(e.prototype,"BallID",{get:function(){return this.ballID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"EnableLifeTime",{get:function(){return this.enableLifeTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Combo",{get:function(){return this.combo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Attack",{get:function(){return this.attack},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LifeTime",{get:function(){return this.lifeTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Continue",{get:function(){return this.continue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Form",{get:function(){return this.form},enumerable:!0,configurable:!0}),e.prototype.use=function(){return!(!this.enableLifeTime||this.Form==o.Monster_ball_ball_form.ZhaDan)||(this.durable-=this.attack,l.gEventMgr.emit(s.GlobalEvent.UPDATE_BALL_LIFE,this.durable/this.totalDurable),this.durable>0)},e.prototype.costLifeTime=function(e){return this.lifeTime+=e,l.gEventMgr.emit(s.GlobalEvent.UPDATE_BALL_LIFE,this.lifeTime/this.totalLife),this.lifeTime>0},e.prototype.update=function(e){this.buff.update(e),this.EnableLifeTime&&(this.costLifeTime(-e)||(a.Game.removeBall(this.BallID),a.Game.setCurBall(null),l.gEventMgr.emit(s.GlobalEvent.UPDATE_BALL_ITEM_NUMBER)))},e}();n.Ball=c,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../TableMgr":"TableMgr","../table":"table","./BuffManager":"BuffManager","./Game":"Game"}],BaseScene:[function(e,t,n){"use strict";cc._RF.push(t,"07e9084SKFEuJNZQVjlVclA","BaseScene"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,a=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.showUI=function(e){var t=this,n=e.split("/").join("_");this.node.getChildByName(n)?console.warn("\u754c\u9762\u5df2\u663e\u793a:"+e):cc.loader.loadRes(e,cc.Prefab,function(e,o){if(e)console.error(e);else{var i=cc.instantiate(o);i.setPosition(0,0),t.node.addChild(i,1,n)}})},t.prototype.closeUI=function(e,t){void 0===t&&(t=!1);var n=e.split("/").join("_"),o=this.node.getChildByName(n);o&&(o.removeFromParent(!0),t&&cc.loader.releaseRes(e))},t=__decorate([i],t)}(cc.Component));n.default=a,cc._RF.pop()},{}],BossZai:[function(e,t,n){"use strict";cc._RF.push(t,"1bbfdrPLKtMvrefLffwM6N4","BossZai"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Game/Monster"),i=e("./MonsterSpine"),a=e("../Event/EventManager"),r=e("../Event/EventName"),s=e("../table"),l=e("./Weakness"),c=cc._decorator,p=c.ccclass,h=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.weaknessRoot=null,t.spine=null,t.monster=null,t.stepTime=0,t.step=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"Spine",{get:function(){return this.spine?this.spine:this.spine=this.getComponent(i.default)},enumerable:!0,configurable:!0}),t.prototype.reuse=function(){this.updateMonsterInfo(arguments[0][0],arguments[0][1]),a.gEventMgr.on(r.GlobalEvent.MONSTER_DIE,this.die,this),a.gEventMgr.on(r.GlobalEvent.MONSTER_UPDATE_STAGE,this.updateStage,this),this.weaknessRoot.active=!0},t.prototype.unuse=function(){this.monster=null,this.id=null,a.gEventMgr.targetOff(this)},t.prototype.die=function(e){this.id==e&&(this.monster=null,this.weaknessRoot.active=!1)},t.prototype.updateMonsterInfo=function(e,t){this.monster=t,this.enabled=this.monster.Type==s.Monster_ball__monster_monster.BOSS,this.id=e;for(var n=0,o=this.weaknessRoot.children;n<o.length;n++){o[n].name=this.id}this.node.setPosition(-1290,-295);var i=this.Spine,a=this;cc.loader.loadRes("Spine/1017/zai",sp.SkeletonData,function(e,t){e?console.error(e):(i.skeletonData=t,i.defaultAnimation="idle",a.updateWeakness(i))})},t.prototype.updateWeakness=function(e){for(var t=0,n=this.weaknessRoot.children;t<n.length;t++){var o=n[t].getComponent(l.default);"bone42"==o.followBone&&3==this.monster.Stage?o.node.active=!1:o.node.active=!0,o.spine=e,o.start()}this.monster.resetState()},t.prototype.updateStage=function(){if(this.monster){var e=this.Spine,t=this;3==this.monster.Stage&&cc.loader.loadRes("Spine/1017/zai_by",sp.SkeletonData,function(n,o){n?console.error(n):(e.skeletonData=o,e.defaultAnimation="idle",t.updateWeakness(e))})}},t.prototype.onLoad=function(){},t.prototype.start=function(){},t.prototype.update=function(e){this.monster&&(1==this.monster.Stage?(this.node.setPosition(-1290,-295),this.Spine.idle()):this.monster.CanMove?(this.Spine.move(),this.stepTime+=e,this.stepTime>this.monster.MoveSpeed/400&&(this.stepTime=0,a.gEventMgr.emit(r.GlobalEvent.BOSS_ZAI_STEP,this.step),1==this.step?this.step=2:this.step=1),this.monster.setState(o.MonsterState.HIDE),this.node.x>=1600?this.node.scaleX=1:this.node.x<=-1600?this.node.scaleX=-1:Math.abs(this.node.x)<800&&this.monster.delState(o.MonsterState.HIDE),this.node.x-=this.monster.MoveSpeed*e*this.node.scaleX):this.Spine.idle())},__decorate([h(cc.Node)],t.prototype,"weaknessRoot",void 0),t=__decorate([p],t)}(cc.Component);n.default=u,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Monster":"Monster","../table":"table","./MonsterSpine":"MonsterSpine","./Weakness":"Weakness"}],BuffManager:[function(e,t,n){"use strict";var o;cc._RF.push(t,"4ca32PuwAhJlZP+EuDUhIFK","BuffManager"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.NUMB=0]="NUMB",e[e.STIFF=1]="STIFF",e[e.RELAX=2]="RELAX"}(o=n.BuffType||(n.BuffType={}));var i=function(){function e(e){this.buffs=new Array,this.id="",this.id=e}return e.prototype.addBuff=function(e){e.name=e.name||"unknow buff",e.isCover=!0===e.isCover,e.isImmediately=!1!==e.isImmediately;for(var t=Date.now(),n=0,i=this.buffs;n<i.length;n++){var a=i[n];if(a.type==e.type&&e.target===a.target)return void(e.isCover?(a.deleteTime=e.lastTime+t,a.handler=e.handler,console.log(this.id+" \u8986\u76d6buff:"+e.name+":"+o[e.type]+",\u603b\u6301\u7eed\u65f6\u95f4:"+(a.deleteTime-a.addTime)+",\u5f53\u524d\u5269\u4f59\u65f6\u95f4:"+(a.deleteTime-t))):(a.deleteTime+=e.lastTime,console.log(this.id+" \u53e0\u52a0buff:"+e.name+":"+o[e.type]+",\u603b\u6301\u7eed\u65f6\u95f4:"+(a.deleteTime-a.addTime)+",\u5f53\u524d\u5269\u4f59\u65f6\u95f4:"+(a.deleteTime-t))))}console.log(this.id+" \u6dfb\u52a0buff:"+e.name+":"+o[e.type]+",LastTime:"+e.lastTime),e.isImmediately&&(e.handler.apply(e.target,e.args),e.isOnce&&(e.handler=null)),this.buffs.push({name:e.name,type:e.type,handler:e.handler,isOnce:e.isOnce,completeHandler:e.completeHandler,duration:e.duration,excuteTime:e.isImmediately?t:t+e.duration,deleteTime:e.lastTime+t,target:e.target,args:e.args,del:!1,addTime:t})},e.prototype.update=function(e){if(!(this.buffs.length<=0)){for(var t=Date.now(),n=[],i=0,a=this.buffs;i<a.length;i++){var r=a[i];!r.del&&r.target?t>=r.deleteTime?(r.completeHandler&&r.completeHandler.apply(r.target),r.del=!0,n.push(this.buffs.indexOf(r))):t>=r.excuteTime&&r.handler&&(r.excuteTime=t+r.duration,r.handler.apply(r.target,r.args),r.isOnce&&(r.handler=null)):n.push(this.buffs.indexOf(r))}for(var s=0,l=n;s<l.length;s++){var c=l[s];console.log(this.id+" \u5220\u9664buff\uff1a"+this.buffs[c].name+",type:"+o[this.buffs[c].type]),this.buffs.splice(c,1)}}},e.prototype.clear=function(){this.buffs=[]},e}();n.BuffManager=i,cc._RF.pop()},{}],CameraController:[function(e,t,n){"use strict";cc._RF.push(t,"3c1b6oCCV1ORbSP1LtO4Sla","CameraController"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Game/Game"),i=e("../Event/EventManager"),a=e("../Event/EventName"),r=function(){function e(){var e=this;this.minZoomRatio=.5,this.maxMoveYRatio=.5,this.zoomRatioSense=1,this.isEnableCameraZoom=!0,this.MainCamera=null,this.UICamera=null,this.target=null,this.enableFollow=!0,this.canZoomOut=!0,cc.director.on(cc.Director.EVENT_AFTER_UPDATE,this.lateUpdate.bind(this),this),i.gEventMgr.on(a.GlobalEvent.MONSTER_ATTACK_DONE,function(){e.shake()},this)}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.shake=function(){var e=cc.sequence(cc.moveBy(.03,cc.v2(0,25)),cc.moveBy(.06,cc.v2(0,-50)),cc.moveBy(.03,cc.v2(0,25))),t=cc.repeat(e,5);this.MainCamera.node.runAction(t)},e.prototype.initCamera=function(){this.enableFollow=!0,this.MainCamera&&this.MainCamera.node&&(CAMERA_SHOW_ALL?(this.MainCamera.node.y=360,this.MainCamera.zoomRatio=.5):(this.MainCamera.node.y=0,this.MainCamera.zoomRatio=1))},e.prototype.zoomIn=function(){this.enableFollow=!1,this.MainCamera.node.stopActionByTag(101);var e=cc.moveTo(.3,cc.v2(0,360));e.setTag(100),this.MainCamera.node.runAction(e)},e.prototype.zoomOut=function(){if(this.canZoomOut&&!CAMERA_SHOW_ALL){var e=cc.moveTo(.3,cc.v2(0,0));e.setTag(101),this.MainCamera.node.stopActionByTag(100),this.MainCamera.node.runAction(e),this.enableFollow=!0}},e.prototype.bindUICamera=function(e){this.UICamera=e},e.prototype.bindMainCamera=function(e){this.MainCamera=e},e.prototype.setTarget=function(e){CAMERA_SHOW_ALL||(this.target=e,this.target)},e.prototype.readyRocket=function(e){CAMERA_SHOW_ALL||this.enableFollow!=!e&&(console.log("enable follow:"+this.enableFollow),e?this.zoomIn():this.zoomOut())},e.prototype.lateUpdate=function(){if(this.MainCamera&&this.MainCamera.node&&this.UICamera&&this.UICamera.node&&o.Game.isRun())if(!CAMERA_SHOW_ALL&&this.enableFollow){if(!this.target||!this.target.isValid)return this.MainCamera.zoomRatio<1?this.MainCamera.zoomRatio+=.05:this.MainCamera.zoomRatio>1&&(this.MainCamera.zoomRatio-=.05),void(this.MainCamera.zoomRatio=CMath.Clamp(this.MainCamera.zoomRatio,1,0));if(this.MainCamera.node.y=this.target.y-cc.winSize.height/4,this.MainCamera.node.y=CMath.Clamp(this.MainCamera.node.y,cc.winSize.height*this.maxMoveYRatio,0),this.target.x>cc.winSize.width/4?this.MainCamera.node.x=this.target.x-cc.winSize.width/4:this.target.x<-cc.winSize.width/4&&(this.MainCamera.node.x=this.target.x+cc.winSize.width/4),this.MainCamera.node.x=CMath.Clamp(this.MainCamera.node.x,cc.winSize.width/2,-cc.winSize.width/2),this.isEnableCameraZoom){var e=1-Math.abs(this.MainCamera.node.x)/cc.winSize.width*2,t=1-Math.abs(this.MainCamera.node.y)/cc.winSize.height;t<this.minZoomRatio&&(t=this.minZoomRatio),t+=(1-e)*(1-t),this.MainCamera.zoomRatio=t}}else this.MainCamera.zoomRatio>.5&&(this.MainCamera.zoomRatio-=.02,this.MainCamera.zoomRatio=this.MainCamera.zoomRatio<.5?.5:this.MainCamera.zoomRatio)},e}();n.gCamera=r.inst,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Game":"Game"}],Config:[function(e,t,n){"use strict";cc._RF.push(t,"66da32otSlAnK03HjoFTe1o","Config"),Object.defineProperty(n,"__esModule",{value:!0}),n.Config={GameID:216437,AppKey:"bc7b7fd603714d888deff0986e24f742#C",Secret:"6f86c9c856504b5d917dd06585553a3f",CocosAppID:"619821021",channel:"Matchvs",platform:"alpha",gameVersion:1,DeviceID:"1",MaxPlayer:2,isMultiPlayer:!1},n.PhysicConf={enabled:!0,gravity:cc.v2(0,-2e3),debugDrawFlags:0,angularVelocity:360,linearVelocity:cc.v2(300,0),applyForce:cc.v2(0,30)},function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"}(n.JUMP_DIR||(n.JUMP_DIR={})),n.Group={Default:"default",Player:"player",UI:"UI",Monster:"monster",Effect:"effect",Wall:"wall",Weakness:"weakness",Ground:"ground"},function(e){e[e.Flash=0]="Flash",e[e.Boom=1]="Boom"}(n.EffectType||(n.EffectType={})),n.ItemRefreshPos={6002:[cc.v2(-524,318),cc.v2(577,95)],6003:[cc.v2(-619,300),cc.v2(582,300)],6001:[cc.v2(177,212),cc.v2(947,563)]},cc._RF.pop()},{}],Effect:[function(e,t,n){"use strict";cc._RF.push(t,"810c2x/gUBN8aCpP6YT0wU/","Effect"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Config/Config"),i=e("../Controller/CameraController"),a=e("../Factory/GameFactory"),r=cc._decorator,s=r.ccclass,l=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.effectType=o.EffectType.Boom,t}return __extends(t,e),Object.defineProperty(t.prototype,"Animation",{get:function(){return this.animation?this.animation:this.animation=this.getComponent(cc.Animation)},enumerable:!0,configurable:!0}),t.prototype.reuse=function(){var e=this,t=arguments[0][1];this.Animation.play("boom",0),this.Animation.on(cc.Animation.EventType.FINISHED,function(){e.effectType==o.EffectType.Boom&&t&&i.gCamera.zoomOut(),a.gFactory.puEffect(e.effectType,e.node)},this)},t.prototype.unuse=function(){this.Animation.targetOff(this)},t.prototype.onLoad=function(){},t.prototype.start=function(){},__decorate([l({type:cc.Enum(o.EffectType)})],t.prototype,"effectType",void 0),t=__decorate([s],t)}(cc.Component);n.default=c,cc._RF.pop()},{"../Config/Config":"Config","../Controller/CameraController":"CameraController","../Factory/GameFactory":"GameFactory"}],EventManager:[function(e,t,n){"use strict";cc._RF.push(t,"b6e82sGGBdLtIXuBXMooro8","EventManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this.eventTarget=new cc.EventTarget}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.emit=function(e,t,n,o,i,a){this.eventTarget.emit(e.toString(),t,n,o,i,a)},e.prototype.on=function(e,t,n,o){return this.eventTarget.on(e.toString(),t,n,o)},e.prototype.once=function(e,t,n){this.eventTarget.once(e.toString(),t,n)},e.prototype.dispatchEvent=function(e){this.eventTarget.dispatchEvent(e)},e.prototype.off=function(e,t,n){this.eventTarget.off(e.toString(),t,n)},e.prototype.hasEventListener=function(e){return this.eventTarget.hasEventListener(e.toString())},e.prototype.targetOff=function(e){this.eventTarget.targetOff(e)},e}();n.gEventMgr=o.inst,cc._RF.pop()},{}],EventName:[function(e,t,n){"use strict";cc._RF.push(t,"26b15WZ9RVFY7I6JqAX2LjE","EventName"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.JUMP=0]="JUMP",e[e.MONSTER_ATTACK=1]="MONSTER_ATTACK",e[e.MONSTER_ADD=2]="MONSTER_ADD",e[e.MONSTER_ATTACK_DONE=3]="MONSTER_ATTACK_DONE",e[e.UPDATE_BALL_ITEM_NUMBER=4]="UPDATE_BALL_ITEM_NUMBER",e[e.CHANGE_CUR_BALL=5]="CHANGE_CUR_BALL",e[e.CHANGE_GAME_SCENE=6]="CHANGE_GAME_SCENE",e[e.CHANGE_SCENE_DONE=7]="CHANGE_SCENE_DONE",e[e.UPDATE_SCENE_HP_PROGRESS=8]="UPDATE_SCENE_HP_PROGRESS",e[e.UPDATE_SCORE=9]="UPDATE_SCORE",e[e.ADD_NEW_MONSTER=10]="ADD_NEW_MONSTER",e[e.ADD_MONSTER_DONE=11]="ADD_MONSTER_DONE",e[e.MONSTER_DIE=12]="MONSTER_DIE",e[e.MONSTER_HIT=13]="MONSTER_HIT",e[e.ADD_EFFECT=14]="ADD_EFFECT",e[e.PRE_SELECT_BALL=15]="PRE_SELECT_BALL",e[e.CUR_BALL_UPDATE=16]="CUR_BALL_UPDATE",e[e.ALL_INIT_DONE=17]="ALL_INIT_DONE",e[e.UPDATE_BALL_LIFE=18]="UPDATE_BALL_LIFE",e[e.GEN_NEXT_LEVEL=19]="GEN_NEXT_LEVEL",e[e.MONSTER_UPDATE_STAGE=20]="MONSTER_UPDATE_STAGE",e[e.GAME_OVER=21]="GAME_OVER",e[e.BOSS_WARNING=22]="BOSS_WARNING",e[e.ADD_ITEM=23]="ADD_ITEM",e[e.ITEM_USE=24]="ITEM_USE",e[e.PLANE_ATTACK_DONE=25]="PLANE_ATTACK_DONE",e[e.BALL_HIT=26]="BALL_HIT",e[e.MAINUI_TOUCH=27]="MAINUI_TOUCH",e[e.BOSS_ZAI_STEP=28]="BOSS_ZAI_STEP"}(n.GlobalEvent||(n.GlobalEvent={})),cc._RF.pop()},{}],GameFactory:[function(e,t,n){"use strict";cc._RF.push(t,"76474PsLk5HM4oIbHHEogNf","GameFactory"),Object.defineProperty(n,"__esModule",{value:!0});var o,i=e("../TableMgr"),a=e("../Utils/HashMap"),r=e("../Config/Config"),s=function(){function e(e,t,n){this._pool=[],this.poolHandlerComps=[],this.poolHandlerComps=n,this.template=e,this.initPool(t)}return e.prototype.initPool=function(e){for(var t=0;t<e;++t){var n=cc.instantiate(this.template);this.put(n)}},e.prototype.size=function(){return this._pool.length},e.prototype.clear=function(){for(var e=this._pool.length,t=0;t<e;++t)this._pool[t].destroy&&this._pool[t].destroy();this._pool.length=0},e.prototype.put=function(e){if(e&&-1===this._pool.indexOf(e)){if(e.removeFromParent(!1),this.poolHandlerComps)for(var t=0,n=this.poolHandlerComps;t<n.length;t++){var o=n[t],i=e.getComponent(o);i&&i.unuse&&i.unuse.apply(i)}else for(var a=0,r=e.getComponents(cc.Component);a<r.length;a++){(o=r[a])&&o.unuse&&o.unuse.apply(o)}this._pool.push(e)}},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this._pool.length-1;n<0&&this.initPool(10),n=this._pool.length-1;var o=this._pool[n];if(this._pool.length=n,this.poolHandlerComps)for(var i=0,a=this.poolHandlerComps;i<a.length;i++){var r=a[i],s=o.getComponent(r);s&&s.reuse&&s.reuse.apply(s,arguments)}else for(var l=0,c=o.getComponents(cc.Component);l<c.length;l++){(r=c[l])&&r.unuse&&r.reuse.apply(r,arguments)}return o},e}();(function(e){e[e.INIT=0]="INIT",e[e.MONSTER=2]="MONSTER",e[e.BALL=4]="BALL",e[e.BACKGROUND=8]="BACKGROUND",e[e.ITEM=16]="ITEM",e[e.EFFECT=32]="EFFECT",e[e.DONE=62]="DONE"})(o||(o={}));var l=function(){function e(){this.step=o.INIT,this.monstersPool=new a.HashMap,this.ballPool=new a.HashMap,this.scenePool=new a.HashMap,this.itemPool=new a.HashMap,this.effectPool=new a.HashMap}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.doneCallback=e,this.initMonsters(),this.initBalls(),this.initBackground(),this.initItems(),this.initEffect()},e.prototype.nextStep=function(e){this.step|=e,console.log("Factory Step:"+o[e]),this.step>=o.DONE&&this.doneCallback&&this.doneCallback()},e.prototype.initMonsters=function(){var e=i.TableMgr.inst.getAll_Monster_ball__monster_Data(),t=this,n=0,a=0;for(var r in e)a++;var l=function(e){var i="Prefabs/Monster/Monster-"+e;cc.loader.loadRes(i,cc.Prefab,function(i,r){if(i)console.error(i);else{var l=cc.instantiate(r);t.monstersPool.add(e,new s(l,10)),++n>=a&&t.nextStep(o.MONSTER)}})};for(var r in e)l(r)},e.prototype.initBalls=function(){var e=i.TableMgr.inst.getAll_Monster_ball_ball_Data();console.log(e);var t=this,n=0,a=0;for(var r in e)a++;var l=function(e){var i="Prefabs/Ball/Ball-"+e;cc.loader.loadRes(i,cc.Prefab,function(i,r){if(i)console.error(i);else{var l=cc.instantiate(r);t.ballPool.add(e,new s(l,10)),++n>=a&&t.nextStep(o.BALL)}})};for(var r in e)l(r)},e.prototype.initBackground=function(){var e=i.TableMgr.inst.getAll_Monster_ball_scene_Data(),t=this,n=0,a=0;for(var r in e)a++;var l=function(e){var i="Prefabs/Background/Background-"+e;cc.loader.loadRes(i,cc.Prefab,function(i,r){if(i)console.error(i);else{var l=cc.instantiate(r);t.scenePool.add(e,new s(l,1)),++n>=a&&t.nextStep(o.BACKGROUND)}})};for(var r in e)l(r)},e.prototype.initItems=function(){var e=i.TableMgr.inst.getAll_Monster_ball_prop_Data(),t=this,n=0,a=0;for(var r in e)a++;var l=function(e){var i="Prefabs/Item/Item-"+e;cc.loader.loadRes(i,cc.Prefab,function(i,r){if(i)console.error(i);else{var l=cc.instantiate(r);t.itemPool.add(e,new s(l,10)),++n>=a&&t.nextStep(o.ITEM)}})};for(var r in e)l(r)},e.prototype.initEffect=function(){var e={};e[r.EffectType.Boom]="Prefabs/Effect/Boom";var t=this,n=0,i=0;for(var a in e)i++;var l=function(a){var r=e[a];cc.loader.loadRes(r,cc.Prefab,function(e,r){if(e)console.error(e);else{var l=cc.instantiate(r);t.effectPool.add(parseInt(a),new s(l,10)),++n>=i&&t.nextStep(o.EFFECT)}})};for(var a in e)l(a)},e.prototype.getEffect=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.effectPool.get(e).get(t)},e.prototype.puEffect=function(e,t){this.effectPool.get(e).put(t)},e.prototype.getMonster=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.monstersPool.get(e).get(t)},e.prototype.getBall=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.ballPool.get(e).get(t)},e.prototype.putMonster=function(e,t){this.monstersPool.get(e).put(t)},e.prototype.putBall=function(e,t){this.ballPool.get(e).put(t)},e.prototype.getBackground=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this.scenePool.get(e).get(t)},e.prototype.putBackground=function(e,t){this.scenePool.get(e).put(t)},e.prototype.getItems=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return console.log(e),this.itemPool.get(e).get(t)},e.prototype.puItems=function(e,t){this.itemPool.get(e).put(t)},e}();n.gFactory=l.inst,cc._RF.pop()},{"../Config/Config":"Config","../TableMgr":"TableMgr","../Utils/HashMap":"HashMap"}],GameScene:[function(e,t,n){"use strict";cc._RF.push(t,"77e59C16F1K6ZvgXVsPzEEZ","GameScene"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./BaseScene"),i=e("../Config/Config"),a=e("../Game/Game"),r=e("../Event/EventName"),s=e("../Event/EventManager"),l=e("../Controller/CameraController"),c=e("../Factory/GameFactory"),p=e("../table"),h=e("./Background"),u=cc._decorator,f=u.ccclass,m=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.BackgroundRoot=null,t.BallRoot=null,t.ItemRoot=null,t.EffectRoot=null,t.MonsterRoot=null,t.LoadingBlock=null,t.oldScene=null,t.MainCamera=null,t.UICamera=null,t.physicManager=cc.director.getPhysicsManager(),t}return __extends(t,e),t.prototype.initPhysic=function(){this.physicManager.enabled=i.PhysicConf.enabled,this.physicManager.gravity=i.PhysicConf.gravity,this.physicManager.debugDrawFlags|=i.PhysicConf.debugDrawFlags},t.prototype.onLoad=function(){var e=this;this.oldScene.node.active=!1,cc.director.preloadScene("Over",null,function(t,n){t?console.error(t):e.overScene=n.scene}),this.MonsterRoot.removeAllChildren(),this.BackgroundRoot.removeAllChildren(),l.gCamera.bindMainCamera(this.MainCamera),l.gCamera.bindUICamera(this.UICamera),l.gCamera.initCamera(),this.initPhysic(),this.initEvent(),this.LoadingBlock.active=!0,this.showUI("Prefabs/MainUI")},t.prototype.start=function(){},t.prototype.initEvent=function(){var e=this;s.gEventMgr.on(r.GlobalEvent.CHANGE_CUR_BALL,this.updateCurBall,this),s.gEventMgr.on(r.GlobalEvent.CHANGE_GAME_SCENE,this.updateCurScene,this),s.gEventMgr.on(r.GlobalEvent.ADD_NEW_MONSTER,this.updateMonsters,this),s.gEventMgr.on(r.GlobalEvent.MONSTER_DIE,this.removeMonster,this),s.gEventMgr.on(r.GlobalEvent.ADD_EFFECT,this.addEffect,this),s.gEventMgr.on(r.GlobalEvent.ALL_INIT_DONE,function(){e.LoadingBlock.active=!1},this),s.gEventMgr.on(r.GlobalEvent.GAME_OVER,this.gameOver,this),s.gEventMgr.on(r.GlobalEvent.ADD_ITEM,this.addItem,this)},t.prototype.gameOver=function(){this.showUI("Prefabs/OverLayer")},t.prototype.updateMonsters=function(){var e=this;a.Game.addMonsters.length<=0||(a.Game.addMonsters.forEach(function(t,n){var o=e.MonsterRoot.getChildByName(t);o&&o.removeFromParent(!0);var i=t.split("-")[1];n.Type==p.Monster_ball__monster_monster.BOSS&&s.gEventMgr.emit(r.GlobalEvent.BOSS_WARNING);var a=c.gFactory.getMonster(i,t,n);e.MonsterRoot.addChild(a),s.gEventMgr.emit(r.GlobalEvent.MONSTER_ADD,n.MonsterID)}),a.Game.addMonsters.clear(),s.gEventMgr.emit(r.GlobalEvent.ADD_MONSTER_DONE))},t.prototype.removeMonster=function(){},t.prototype.updateCurScene=function(e){if(e){var t=this.BackgroundRoot.children[0];if(t&&t.name==e.toString())return s.gEventMgr.emit(r.GlobalEvent.ADD_NEW_MONSTER),void s.gEventMgr.emit(r.GlobalEvent.CHANGE_SCENE_DONE,e);var n=this;if(t){console.log(t);var o=t.getComponent(h.default),i=o&&o.isBroken?"_broken":"_normal";cc.loader.loadRes("Texture/Scene/"+t.name+i,cc.SpriteFrame,function(o,i){c.gFactory.putBackground(t.name,t),o?console.error(o):(n.oldScene.node.active=!0,n.oldScene.spriteFrame=i);var a=c.gFactory.getBackground(e.toString(),e);a.name=e.toString(),n.BackgroundRoot.addChild(a),s.gEventMgr.emit(r.GlobalEvent.CHANGE_SCENE_DONE,e)})}else{this.oldScene.node.active=!1;var a=c.gFactory.getBackground(e.toString(),e);a.name=e.toString(),this.BackgroundRoot.addChild(a),s.gEventMgr.emit(r.GlobalEvent.CHANGE_SCENE_DONE,e),s.gEventMgr.emit(r.GlobalEvent.ADD_NEW_MONSTER)}}else console.error("sceneID undefined!")},t.prototype.addItem=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t],i=c.gFactory.getItems(o.itemID,o.itemID,o.index);i.setPosition(o.initPos),this.ItemRoot.addChild(i)}},t.prototype.updateCurBall=function(e,t,n){if(e){var o=c.gFactory.getBall(e.BallID.toString(),e.BallID,e,n);o.name=e.BallID.toString(),t&&o.setPosition(t),this.BallRoot.removeAllChildren(),this.BallRoot.addChild(o),l.gCamera.setTarget(o),s.gEventMgr.emit(r.GlobalEvent.CUR_BALL_UPDATE,!1,e.BallID)}else if(this.BallRoot.childrenCount>0){var i=this.BallRoot.children[0];c.gFactory.putBall(i.name,i),l.gCamera.setTarget(null),s.gEventMgr.emit(r.GlobalEvent.CUR_BALL_UPDATE,!0,null)}},t.prototype.addEffect=function(e,t,n){void 0===n&&(n=!0);var o=c.gFactory.getEffect(e,e,n),i=this.EffectRoot.convertToNodeSpaceAR(t);o.setPosition(i),this.EffectRoot.addChild(o)},t.prototype.update=function(e){a.Game.update(e)},__decorate([m(cc.Node)],t.prototype,"BackgroundRoot",void 0),__decorate([m(cc.Node)],t.prototype,"BallRoot",void 0),__decorate([m(cc.Node)],t.prototype,"ItemRoot",void 0),__decorate([m(cc.Node)],t.prototype,"EffectRoot",void 0),__decorate([m(cc.Node)],t.prototype,"MonsterRoot",void 0),__decorate([m(cc.Node)],t.prototype,"LoadingBlock",void 0),__decorate([m(cc.Sprite)],t.prototype,"oldScene",void 0),__decorate([m(cc.Camera)],t.prototype,"MainCamera",void 0),__decorate([m(cc.Camera)],t.prototype,"UICamera",void 0),t=__decorate([f],t)}(o.default);n.default=d,cc._RF.pop()},{"../Config/Config":"Config","../Controller/CameraController":"CameraController","../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Factory/GameFactory":"GameFactory","../Game/Game":"Game","../table":"table","./Background":"Background","./BaseScene":"BaseScene"}],Game:[function(e,t,n){"use strict";cc._RF.push(t,"6a81f8eJfVKtIiDBlLB7gVo","Game"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../TableMgr"),i=e("./Ball"),a=e("../Utils/HashMap"),r=e("../Event/EventName"),s=e("../table"),l=e("./Monster"),c=e("./BuffManager"),p=e("../Event/EventManager"),h=e("../Controller/CameraController"),u=e("../Config/Config"),f=function(){function e(){this.levels=[],this.level=0,this.sceneID=0,this.curHp=0,this.totalScore=0,this.combo=0,this.balls=new a.HashMap,this.monsters=new a.HashMap,this.items=new a.HashMap,this.curItems=new a.HashMap,this.monsterIDQueue=[],this.fighttingMonsters=new a.HashMap,this.addMonsters=new a.HashMap,this.monsterCounts=0,this.isRunning=!1,this.monsterUpdateTime=0,this.needAddMonster=!1,this.itemRefreshCD=5,this.itemCD=0,this.needAddItem=!1}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.initItems=function(){if(this.levelStaticInfo&&0!=this.level){if(this.itemCD=0,this.needAddItem=!0,this.items.clear(),this.levelStaticInfo.prop)for(var e=0,t=this.levelStaticInfo.prop;e<t.length;e++){var n=t[e],o=parseInt(n.split("|")[0]),i=parseInt(n.split("|")[1]);this.items.add(o.toString(),i)}}else console.error("\u9700\u8981\u5148\u521d\u59cb\u5316\u5f53\u524dlevel\uff1a"+this.level)},e.prototype.initMonsters=function(){if(this.levelStaticInfo&&0!=this.level){this.monsters.clear(),this.fighttingMonsters.clear(),this.monsterCounts=0,this.monsterIDQueue=[];for(var e=1;e<=3&&this.levelStaticInfo["monster"+e];++e)for(var t=0,n=this.levelStaticInfo["monster"+e];t<n.length;t++){var o=n[t];if(""!=o){var i=parseInt(o.split("|")[0]),a=i.toString()+"-"+e.toString();this.monsterIDQueue.push(a);for(var r=parseInt(o.split("|")[1]),s=[];r-- >0;){var c=new l.Monster(i);c.initPos=e,s.push(c)}var p=this.monsters.get(a);p?this.monsters.add(a,p.concat(s)):this.monsters.add(a,s)}}var h={};for(e=0;e<this.monsterIDQueue.length;++e)h[this.monsterIDQueue[e]]?(this.monsterIDQueue.splice(e,1),--e):h[this.monsterIDQueue[e]]=e;console.log(this.monsterIDQueue),console.log(this.monsters.values.concat())}else console.error("\u9700\u8981\u5148\u521d\u59cb\u5316\u5f53\u524dlevel\uff1a"+this.level)},e.prototype.setRunning=function(e){this.isRunning=e},e.prototype.isRun=function(){return this.isRunning},e.prototype.updateFightMonsters=function(){if(!(this.checkNextLevel()||this.monsterIDQueue.length<=0))if(this.fighttingMonsters.length>=this.levelStaticInfo.monste_max)console.log("\u8d85\u8fc7\u6700\u5927\u6570\u91cf");else{for(var e=this.monsterIDQueue.concat(),t=!1;e.length>0;){var n=e.shift(),o=1;if(n){if(this.fighttingMonsters.length>=this.levelStaticInfo.monste_max)break;var i=this.monsters.get(n);if(i){for(;o-- >0;){var a=i.pop();if(!a)break;var r=this.monsterCounts+"-"+n;if(this.fighttingMonsters.get(r))console.error("\u91cd\u590d\u7684\u602a\u7269:"+r);else if(t=!0,this.monsterCounts++,this.fighttingMonsters.add(r,a),this.addMonsters.add(r,a),this.fighttingMonsters.length>=this.levelStaticInfo.monste_max)break}if(i.length>0);else{console.log("monster remove:"+n),this.monsters.remove(n);var s=this.monsterIDQueue.indexOf(n);this.monsterIDQueue.splice(s,1)}}}}t&&(this.needAddMonster=!1)}},e.prototype.initBalls=function(){if(0!=this.level&&this.levelStaticInfo){this.balls.clear();for(var e=0,t=o.TableMgr.inst.getMonster_ball_paly_level(this.level).ball;e<t.length;e++){var n=t[e];if(""!=n){for(var a=parseInt(n.split("|")[0]),s=parseInt(n.split("|")[1]),l=[];s-- >0;)l.push(new i.Ball(a));this.balls.add(a,l)}}p.gEventMgr.emit(r.GlobalEvent.UPDATE_BALL_ITEM_NUMBER)}else console.error("\u9700\u8981\u5148\u521d\u59cb\u5316\u5f53\u524dlevel\uff1a"+this.level)},e.prototype.initLevels=function(){this.levels=[];var e=o.TableMgr.inst.getAll_Monster_ball_paly_level_Data();for(var t in e)this.levels.push(parseInt(t));this.levels.sort(function(e,t){return e-t}),console.log(this.levels),this.level=0,this.nextLevel()},e.prototype.nextLevel=function(){p.gEventMgr.emit(r.GlobalEvent.GEN_NEXT_LEVEL);var e=Date.now();this.setRunning(!1);var t=this;this.setCurBall(null),h.gCamera.initCamera(),cc.director.once(cc.Director.EVENT_BEFORE_UPDATE,function(){console.log(" start next level: "+(Date.now()-e)+"ms"),0!=t.level&&t.levelStaticInfo&&(t.addScore(t.levelStaticInfo.score),t.curHp>=t.levelStaticInfo.hp_mini&&t.addScore(t.levelStaticInfo.subjoin)),t.levels.length<=0?console.log("cross over all level"):(t.level=t.levels.shift(),t.levelStaticInfo=o.TableMgr.inst.getMonster_ball_paly_level(t.level),t.sceneID!=t.levelStaticInfo.map&&(t.sceneID=t.levelStaticInfo.map),t.initMonsters(),t.initBalls(),t.initItems(),t.updateFightMonsters(),p.gEventMgr.emit(r.GlobalEvent.CHANGE_GAME_SCENE,t.levelStaticInfo.map),t.curHp=t.levelStaticInfo.hp,p.gEventMgr.emit(r.GlobalEvent.UPDATE_SCENE_HP_PROGRESS,t.curHp/t.levelStaticInfo.hp))}.bind(this),this)},e.prototype.start=function(){this.setScore(0),this.initLevels()},e.prototype.setScore=function(e){this.totalScore=e,p.gEventMgr.emit(r.GlobalEvent.UPDATE_SCORE,this.totalScore)},e.prototype.addScore=function(e){this.totalScore+=e,this.totalScore=Math.max(0,this.totalScore),p.gEventMgr.emit(r.GlobalEvent.UPDATE_SCORE,this.totalScore)},e.prototype.changeCurBall=function(e,t,n){if(this.curBall){if(this.curBall.BallID==e)return;var o=this.balls.get(this.curBall.BallID);o&&o.push(this.curBall)}var i=this.balls.get(e);!i||i.length<=0?console.error(" ball not exist in balls:"+e):this.setCurBall(i.shift(),t,n)},e.prototype.setCurBall=function(e,t,n){this.curBall=e,p.gEventMgr.emit(r.GlobalEvent.CHANGE_CUR_BALL,e,t,n)},e.prototype.getBallNumber=function(e){var t=this.balls.get(e);return t?t.length:0},e.prototype.addHp=function(e){this.curHp+=e,this.curHp=CMath.Clamp(this.curHp,this.levelStaticInfo.hp,0),p.gEventMgr.emit(r.GlobalEvent.UPDATE_SCENE_HP_PROGRESS,this.curHp/this.levelStaticInfo.hp),this.curHp<=0&&this.gameOver()},e.prototype.ballCost=function(e){this.curBall?this.curBall.BallID==e?this.curBall.use()||(console.log("\u8010\u4e45\u5ea6\u8017\u5c3d"),p.gEventMgr.emit(r.GlobalEvent.UPDATE_BALL_ITEM_NUMBER,e),this.setCurBall(null),this.removeBall(e)):console.error("cur ball id unmatch:"+this.curBall.BallID+":"+e):console.error(" cur ball null")},e.prototype.removeBall=function(e){var t=this.balls.get(e);t&&t.length<=0&&this.balls.remove(e),this.balls.length<=0&&this.monsters.length>0&&this.fighttingMonsters.length>0&&this.gameOver()},e.prototype.gameOver=function(){this.setRunning(!1),p.gEventMgr.emit(r.GlobalEvent.GAME_OVER)},e.prototype.excuteBallUpdate=function(e){this.curBall&&this.curBall.update(e)},e.prototype.excuteMonstersUpdate=function(e){this.fighttingMonsters.forEach(function(t,n){n.update(e,t)})},e.prototype.checkNextLevel=function(){return this.monsters.length<=0&&this.fighttingMonsters.length<=0&&(this.nextLevel(),!0)},e.prototype.update=function(e){this.isRunning&&(this.excuteBallUpdate(e),this.needAddMonster&&(this.monsterUpdateTime+=e),this.checkNextLevel()||((this.monsterUpdateTime>3||0==this.fighttingMonsters.length)&&(this.updateFightMonsters(),this.monsterUpdateTime=0),this.excuteMonstersUpdate(e),this.needAddItem&&(this.itemCD+=e,this.itemCD>=this.itemRefreshCD&&(this.itemCD=0,this.needAddItem=!1,this.addItem()))))},e.prototype.addItem=function(){var e=this,t=this.levelStaticInfo.prop_max;if(!(t<=0||this.items.length<=0)){var o=[],i=[],a=u.ItemRefreshPos[n.Game.sceneID].concat();this.items.forEach(function(n,r){if(r<=0)i.push(n);else if(!(o.length>=t||a.length<=0)){var s=a.length-1;if(e.curItems.get(s))a.pop();else{e.curItems.add(s,n);var l={itemID:n,initPos:a.pop(),index:s};e.items.add(n,r-1),o.push(l)}}});for(var s=0,l=i;s<l.length;s++){var c=l[s];this.items.remove(c)}o.length>0&&p.gEventMgr.emit(r.GlobalEvent.ADD_ITEM,o)}},e.prototype.removeItem=function(e){this.curItems.remove(e),this.needAddItem=!0},e.prototype.attackAll=function(e){for(var t=0,n=this.fighttingMonsters.keys;t<n.length;t++){var o=n[t],i=this.fighttingMonsters.get(o);i?i.Invincible||(i.addHp(-e)?(i.setState(l.MonsterState.HIT),p.gEventMgr.emit(r.GlobalEvent.MONSTER_HIT,o)):(this.addScore(i.Score),p.gEventMgr.emit(r.GlobalEvent.MONSTER_DIE,o),this.fighttingMonsters.remove(o),this.needAddMonster=!0)):console.warn(" monster is null")}},e.prototype.numbAll=function(e){this.fighttingMonsters.forEach(function(t,n){if(!n.Invincible){var o={name:"\u9ebb\u75f9\u602a\u517d",type:c.BuffType.NUMB,isCover:!1,isImmediately:!0,isOnce:!0,handler:function(){n.setState(l.MonsterState.NUMB)},completeHandler:function(){n.delState(l.MonsterState.NUMB)},lastTime:1e3*e,duration:0,target:n};n.buff.addBuff(o)}})},e.prototype.ballAttack=function(e,t){if(this.curBall)if(this.curBall.BallID==e){var n=this.fighttingMonsters.get(t);if(n)if(n.Invincible)this.ballCost(e);else{if(n.addHp(-this.curBall.Attack))switch(n.setState(l.MonsterState.HIT),p.gEventMgr.emit(r.GlobalEvent.MONSTER_HIT,t),this.curBall.Form){case s.Monster_ball_ball_form.DianJiMaBi:this.numbMonster(n)}else this.addScore(n.Score),p.gEventMgr.emit(r.GlobalEvent.MONSTER_DIE,t),this.fighttingMonsters.remove(t),this.needAddMonster=!0;this.ballCost(e)}else console.error("\u53d7\u653b\u51fb\u602a\u7269\u4e0d\u5728\u5f53\u524d\u6218\u6597\u602a\u7269\u5217\u8868:"+t)}else console.error("\u653b\u51fb\u7403:"+e+" \u4e0d\u662f\u5f53\u524d\u7403:"+this.curBall.BallID);else console.log("\u5f53\u524d\u573a\u666f\u6ca1\u6709\u7403,\u53ef\u80fd\u662flifeTime\u7528\u5c3d:"+e)},e.prototype.numbMonster=function(e){if(this.curBall){var t={name:"\u9ebb\u75f9\u602a\u517d",type:c.BuffType.NUMB,isCover:!1,isImmediately:!0,isOnce:!0,handler:function(){e.setState(l.MonsterState.NUMB)},completeHandler:function(){e.delState(l.MonsterState.NUMB)},lastTime:1e3*this.curBall.Continue,duration:0,target:e};e.buff.addBuff(t)}else console.error("\u653b\u51fb\u7403\u4e0d\u5b58\u5728")},e}();n.Game=f.inst,cc._RF.pop()},{"../Config/Config":"Config","../Controller/CameraController":"CameraController","../Event/EventManager":"EventManager","../Event/EventName":"EventName","../TableMgr":"TableMgr","../Utils/HashMap":"HashMap","../table":"table","./Ball":"Ball","./BuffManager":"BuffManager","./Monster":"Monster"}],HashMap:[function(e,t,n){"use strict";cc._RF.push(t,"96215VUsb1F1bf/LYNJmv41","HashMap"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this._list=new Array,this.clear()}return e.prototype.getIndexByKey=function(e){for(var t=this._list.length,n=0;n<t;n++){if(this._list[n].key==e)return n}return-1},Object.defineProperty(e.prototype,"keys",{get:function(){for(var e=new Array,t=0,n=this._list;t<n.length;t++){var o=n[t];o&&e.push(o.key)}return e},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){var n={key:e,value:t},o=this.getIndexByKey(e);-1!=o?this._list[o]=n:this._list.push(n)},Object.defineProperty(e.prototype,"values",{get:function(){return this._list},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){var t=this.getIndexByKey(e);if(-1!=t){var n=this._list[t];return this._list.splice(t,1),n}return null},e.prototype.has=function(e){return-1!=this.getIndexByKey(e)},e.prototype.get=function(e){var t=this.getIndexByKey(e);return-1!=t?this._list[t].value:null},Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!0,configurable:!0}),e.prototype.sort=function(e){this._list.sort(e)},e.prototype.forEachKeyValue=function(e){for(var t=this._list.length,n=0;n<t;n++){e(this._list[n])}},e.prototype.forEach=function(e){for(var t=this._list.length,n=0;n<t;n++){var o=this._list[n];e(o.key,o.value)}},e.prototype.clear=function(){this._list=[]},e}();n.HashMap=o,cc._RF.pop()},{}],HorizontalMovement:[function(e,t,n){"use strict";cc._RF.push(t,"2bd18kkyVhB3qxIKwDUpik5","HorizontalMovement"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Game/Monster"),i=e("./MonsterSpine"),a=e("../Event/EventName"),r=e("../Event/EventManager"),s=e("./MonsterCtrl"),l=e("../Game/BuffManager"),c=e("../table"),p=cc._decorator,h=p.ccclass,u=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.monster=null,t.stage=0,t.moveCD=0,t}return __extends(t,e),t.prototype.reuse=function(){r.gEventMgr.on(a.GlobalEvent.MONSTER_DIE,this.die,this),this.updateMonsterInfo(arguments[0][0],arguments[0][1])},t.prototype.die=function(e){this.id==e&&(this.monster=null)},Object.defineProperty(t.prototype,"Spine",{get:function(){return this.spine?this.spine:this.spine=this.getComponent(i.default)},enumerable:!0,configurable:!0}),t.prototype.unuse=function(){r.gEventMgr.targetOff(this),this.monster=null,this.id=this.readID="",this.stage=0},t.prototype.updateMonsterInfo=function(e,t){this.id=e,this.readID=t.MonsterID.toString(),this.monster=t,this.stage=this.monster.Stage,this.enabled=this.monster.realMoveType==s.MoveType.GroundMove&&this.monster.Type!=c.Monster_ball__monster_monster.BOSS},t.prototype.start=function(){},t.prototype.update=function(e){var t=this;if(this.monster){if(!(cc.director.getTotalFrames()%300)){var n={name:"\u4f11\u606f\u4e00\u4e0b",type:l.BuffType.RELAX,handler:function(){console.log("\u8bbe\u7f6e\u4f11\u606f"),t.monster.setState(o.MonsterState.RELAX)},completeHandler:function(){t.monster&&t.monster.delState(o.MonsterState.RELAX)},isOnce:!0,isImmediately:!0,duration:0,lastTime:1e3*this.monster.StiffTime,target:this,isCover:!0};this.monster.buff.addBuff(n)}this.monster.CanMove?(this.Spine.move(),this.monster.setState(o.MonsterState.HIDE),this.node.x>=1600?this.node.scaleX=1:this.node.x<=-1600?this.node.scaleX=-1:Math.abs(this.node.x)<800&&this.monster.delState(o.MonsterState.HIDE),this.node.x-=this.monster.MoveSpeed*e*this.node.scaleX):this.Spine.idle()}},t=__decorate([h],t)}(cc.Component));n.default=u,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/BuffManager":"BuffManager","../Game/Monster":"Monster","../table":"table","./MonsterCtrl":"MonsterCtrl","./MonsterSpine":"MonsterSpine"}],Item:[function(e,t,n){"use strict";cc._RF.push(t,"b575eAMZaJP3IL3H96DDZtz","Item"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../table"),i=e("../Factory/GameFactory"),a=e("../Game/Game"),r=e("../Event/EventManager"),s=e("../Event/EventName"),l=e("../TableMgr"),c=cc._decorator,p=c.ccclass,h=(c.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.itemData=null,t.index=-1,t}return __extends(t,e),t.prototype.start=function(){var e=this;this.type=cc.RigidBodyType.Static,r.gEventMgr.on(s.GlobalEvent.GEN_NEXT_LEVEL,function(){e.itemID&&e.node&&i.gFactory.puItems(e.itemID,e.node)},this)},t.prototype.reuse=function(){this.itemID=arguments[0][0],this.index=arguments[0][1],this.itemData=l.TableMgr.inst.getMonster_ball_prop(this.itemID)},t.prototype.unuse=function(){this.itemData=null,this.index=null,this.itemID=null},t.prototype.onBeginContact=function(e,t,n){if(this.itemData){var l=void 0;switch(this.itemData.form){case o.Monster_ball_prop_form.HuiFuNaiJiuDu:var c=this.itemData.recover;l=function(){a.Game.addHp(c)}.bind(this);break;case o.Monster_ball_prop_form.JiaFenShu:break;case o.Monster_ball_prop_form.QuanBuGuaiWuTingDun:var p=this.itemData.continue;l=function(){a.Game.numbAll(p)}.bind(this);break;case o.Monster_ball_prop_form.QuanPingGongJiGuaiWu:var h=this.itemData.attack;l=function(){a.Game.attackAll(h),r.gEventMgr.emit(s.GlobalEvent.PLANE_ATTACK_DONE)}.bind(this)}r.gEventMgr.emit(s.GlobalEvent.ITEM_USE,this.itemData.form,this.itemData.ID,l),a.Game.addScore(this.itemData.subjoin)}a.Game.removeItem(this.index),i.gFactory.puItems(this.itemID,this.node)},t=__decorate([p],t)}(cc.RigidBody));n.default=h,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Factory/GameFactory":"GameFactory","../Game/Game":"Game","../TableMgr":"TableMgr","../table":"table"}],MainUI:[function(e,t,n){"use strict";cc._RF.push(t,"ec2bcfHFttIP5etQE6CTIcF","MainUI"),Object.defineProperty(n,"__esModule",{value:!0});var o,i=e("../Event/EventName"),a=e("../Config/Config"),r=e("../TableMgr"),s=e("../Game/Game"),l=e("./BallTab"),c=e("../Event/EventManager"),p=e("../Controller/CameraController"),h=e("../table");(function(e){e[e.START=0]="START",e[e.SCENE=4]="SCENE",e[e.BALL_TAB=8]="BALL_TAB",e[e.MONSTER=16]="MONSTER",e[e.DONE=28]="DONE"})(o=n.Init_Step||(n.Init_Step={}));var u=cc._decorator,f=u.ccclass,m=u.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.HpProgressBar=null,t.ScoreLabel=null,t.bgBlock=null,t.Debug=null,t.BallTabRoot=null,t.BallNumber=null,t.Top=null,t.Bottom=null,t.Left=null,t.Right=null,t.Wainning=null,t.animation=null,t.score=0,t.step=o.START,t.itemCallback={},t.levelLabel=null,t}return __extends(t,e),t.prototype.initEvent=function(){var e=this;c.gEventMgr.on(i.GlobalEvent.UPDATE_SCENE_HP_PROGRESS,this.updateProgress,this),c.gEventMgr.on(i.GlobalEvent.UPDATE_SCORE,this.updateScore,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouched.bind(this),this),c.gEventMgr.on(i.GlobalEvent.CHANGE_GAME_SCENE,this.startLoadScene,this),c.gEventMgr.on(i.GlobalEvent.BOSS_WARNING,this.bossWarning,this),c.gEventMgr.on(i.GlobalEvent.CHANGE_SCENE_DONE,this.onSceneLoadDone.bind(this),this),c.gEventMgr.on(i.GlobalEvent.PRE_SELECT_BALL,this.updateCurBall,this),c.gEventMgr.on(i.GlobalEvent.CUR_BALL_UPDATE,this.onCurBallUpdate,this),c.gEventMgr.on(i.GlobalEvent.GEN_NEXT_LEVEL,function(){console.log(" gen next level\uff1a"+Date.now()),e.enableBlock(!0),c.gEventMgr.once(i.GlobalEvent.ADD_MONSTER_DONE,function(){e.next(o.MONSTER)},e)},this),this.Animation.on(cc.Animation.EventType.FINISHED,this.onAnimationDone,this),c.gEventMgr.on(i.GlobalEvent.ITEM_USE,this.itemUse,this),this.node.on(cc.Node.EventType.TOUCH_END,function(){c.gEventMgr.emit(i.GlobalEvent.MAINUI_TOUCH)},this)},t.prototype.onCurBallUpdate=function(e,t){if(this.curBallID&&e||t==this.curBallID){var n=s.Game.getBallNumber(this.curBallID);this.updateTabLabel("/"+n)}else this.updateTabLabel("")},t.prototype.initAdaptionSize=function(){cc.sys.isMobile&&(this.Left.width=Math.abs(cc.view.getFrameSize().width-cc.winSize.width)/2,this.Right.width=this.Left.width,this.Top.height=Math.abs(cc.view.getFrameSize().height-cc.winSize.height)/2,this.Bottom.height=this.Top.height)},Object.defineProperty(t.prototype,"Animation",{get:function(){return this.animation||(this.animation=this.getComponent(cc.Animation)),this.animation},enumerable:!0,configurable:!0}),t.prototype.bossWarning=function(){this.Wainning.active||(console.log("boss warning"),this.Wainning.active=!0,c.gEventMgr.emit(i.GlobalEvent.BOSS_WARNING),this.Animation.playAdditive("warning"))},t.prototype.onSceneLoadDone=function(e){this.sceneID=e;r.TableMgr.inst.getMonster_ball_scene(this.sceneID);this.next(o.SCENE)},t.prototype.next=function(e){this.step|=e,console.log("MAINUI Step:"+o[e]+", total :"+this.step),this.step>=o.DONE&&(this.Animation.playAdditive("sceneFade"),c.gEventMgr.emit(i.GlobalEvent.ALL_INIT_DONE),this.step=o.START)},t.prototype.itemUse=function(e,t,n){switch(e){case h.Monster_ball_prop_form.HuiFuNaiJiuDu:this.Animation.playAdditive("recover"),this.itemCallback.recover=n;break;case h.Monster_ball_prop_form.JiaFenShu:break;case h.Monster_ball_prop_form.QuanBuGuaiWuTingDun:n();break;case h.Monster_ball_prop_form.QuanPingGongJiGuaiWu:this.Animation.playAdditive("plane"),this.itemCallback.plane=n}},t.prototype.onAnimationDone=function(){switch(arguments[1].clip.name){case"sceneFade":s.Game.setRunning(!0),this.enableBlock(!1);break;case"warning":this.Wainning.active=!1;break;case"recover":case"plane":this.itemCallback[arguments[1].clip.name]&&(this.itemCallback[arguments[1].clip.name](),this.itemCallback[arguments[1].clip.name]=null)}},Object.defineProperty(t.prototype,"LevelLabel",{get:function(){return this.levelLabel||(this.levelLabel=this.bgBlock.getChildByName("SceneDec").getComponent(cc.Label)),this.levelLabel},enumerable:!0,configurable:!0}),t.prototype.enableBlock=function(e){this.bgBlock.active||(this.bgBlock.active=!0),e?(this.bgBlock.getComponent(cc.BlockInputEvents).enabled=!0,this.bgBlock.opacity=255,this.bgBlock.getChildByName("SceneDec").active=!0,this.LevelLabel.string="Level: "+s.Game.level.toString()):(this.bgBlock.getComponent(cc.BlockInputEvents).enabled=!1,this.bgBlock.opacity=0,this.bgBlock.getChildByName("SceneDec").active=!1)},t.prototype.onLoad=function(){this.Debug.active=!1,this.enableBlock(!0),this.HpProgressBar.progress=1,this.ScoreLabel.string="0",this.initAdaptionSize(),this.initEvent(),this.Wainning.active=!1,cc.director.once(cc.Director.EVENT_AFTER_UPDATE,s.Game.start,s.Game)},t.prototype.initDebug=function(){var e=this.Debug.getChildByName("toggle");e.getComponent(cc.Toggle).isChecked=!1,e.on("toggle",function(){CAMERA_SHOW_ALL=e.getComponent(cc.Toggle).isChecked,e.getComponent(cc.Toggle).isChecked?p.gCamera.zoomIn():p.gCamera.zoomOut()},this)},t.prototype.startLoadScene=function(){this.enableBlock(!0),this.sceneID=0,this.updateTabLabel(""),console.log("\u5f00\u59cb\u52a0\u8f7d\u573a\u666f"),this.updateBallList()},t.prototype.updateCurBall=function(e){this.curBallID=e,e?this.updateTabLabel("/"+s.Game.getBallNumber(e)):this.updateTabLabel("")},t.prototype.updateTabLabel=function(e){this.BallNumber.string=e},t.prototype.updateScore=function(e){console.log(" score: "+e),this.score=e,this.ScoreLabel.string=e.toString()},t.prototype.updateBallList=function(){for(var e=r.TableMgr.inst.getMonster_ball_paly_level(s.Game.level),t=0,n=this.BallTabRoot.children;t<n.length;t++){n[t].getComponent(l.default).offEvent()}for(var i=0,a=0;a<e.ball.length;++a){var c=e.ball[a];if(c){var p=this.BallTabRoot.getChildByName("Item"+(a+1));p&&p.getComponent(l.default).updateBallInfo(parseInt(c.split("|")[0]),function(){++i>=e.ball.length&&this.next(o.BALL_TAB)}.bind(this))}}},t.prototype.onTouched=function(e){c.gEventMgr.emit(i.GlobalEvent.JUMP,s.Game.curBall?s.Game.curBall.BallID:0,e.getLocationX()>cc.winSize.width/2?a.JUMP_DIR.RIGHT:a.JUMP_DIR.LEFT)},t.prototype.updateProgress=function(e){this.HpProgressBar.progress=e,this.HpProgressBar.progress=Math.max(this.HpProgressBar.progress,0)},t.prototype.start=function(){},t.prototype.update=function(e){},__decorate([m(cc.ProgressBar)],t.prototype,"HpProgressBar",void 0),__decorate([m(cc.Label)],t.prototype,"ScoreLabel",void 0),__decorate([m(cc.Node)],t.prototype,"bgBlock",void 0),__decorate([m(cc.Node)],t.prototype,"Debug",void 0),__decorate([m(cc.Node)],t.prototype,"BallTabRoot",void 0),__decorate([m(cc.Label)],t.prototype,"BallNumber",void 0),__decorate([m(cc.Node)],t.prototype,"Top",void 0),__decorate([m(cc.Node)],t.prototype,"Bottom",void 0),__decorate([m(cc.Node)],t.prototype,"Left",void 0),__decorate([m(cc.Node)],t.prototype,"Right",void 0),__decorate([m(cc.Node)],t.prototype,"Wainning",void 0),t=__decorate([f],t)}(cc.Component);n.default=d,cc._RF.pop()},{"../Config/Config":"Config","../Controller/CameraController":"CameraController","../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Game":"Game","../TableMgr":"TableMgr","../table":"table","./BallTab":"BallTab"}],MonsterCtrl:[function(e,t,n){"use strict";cc._RF.push(t,"6346cfqv9ZIhaO00OrsI747","MonsterCtrl"),Object.defineProperty(n,"__esModule",{value:!0});var o,i=e("../Game/Monster"),a=e("../table"),r=e("../Event/EventManager"),s=e("../Event/EventName"),l=e("../Game/Game"),c=e("./MonsterSpine"),p=e("./TeleportMovement"),h=cc._decorator,u=h.ccclass,f=h.property;(function(e){e[e.FlyMove=0]="FlyMove",e[e.GroundMove=1]="GroundMove",e[e.Static=2]="Static",e[e.Teleport=3]="Teleport"})(o=n.MoveType||(n.MoveType={}));var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.weaknessRoot=null,t.ani=null,t.spine=null,t.monster=null,t.initAni="",t.moveAni="",t}return __extends(t,e),t.prototype.reuse=function(){this.updateMonsterInfo(arguments[0][0],arguments[0][1]),r.gEventMgr.on(s.GlobalEvent.MONSTER_DIE,this.die,this),this.weaknessRoot.active=!0},t.prototype.unuse=function(){this.monster=null,this.id=null,r.gEventMgr.off(s.GlobalEvent.MONSTER_DIE,this.die,this),this.animation.targetOff(this)},t.prototype.die=function(e){this.id==e&&(this.monster=null,this.weaknessRoot.active=!1)},Object.defineProperty(t.prototype,"animation",{get:function(){return this.ani||(this.ani=this.node.getComponent(cc.Animation)),this.ani},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Spine",{get:function(){return this.spine?this.spine:this.spine=this.getComponent(c.default)},enumerable:!0,configurable:!0}),t.prototype.move=function(){this.monster.realMoveType==o.Teleport&&(this.weaknessRoot.active=!1)},t.prototype.idle=function(){this.monster.realMoveType==o.Teleport&&(this.weaknessRoot.active=!0)},t.prototype.update=function(e){if(Math.abs(this.node.scaleX)<1&&(this.node.scaleX=this.node.scaleX>0?1:-1),!this.monster)return this.animation.stop(),void this.Spine.idle();this.monster.realMoveType!=o.Teleport&&this.monster.realMoveType!=o.GroundMove&&this.monster.realMoveType!=o.Static&&(this.monster.CanMove?(this.animation.resume(),this.Spine.move()):(this.animation.pause(),this.Spine.idle()))},t.prototype.updateMonsterInfo=function(e,t){switch(this.monster=t,this.enabled=this.monster.Type!=a.Monster_ball__monster_monster.BOSS,this.id=e,this.moveAni="move-"+l.Game.sceneID+"-"+this.monster.initPos,this.initAni="init-"+l.Game.sceneID+"-"+this.monster.initPos,this.monster.Stage){case i.MonsterStage.STAGE_0:this.checkMoveType_0();break;case i.MonsterStage.STAGE_1:this.checkMoveType_1();break;case i.MonsterStage.STAGE_2:this.checkMoveType_2()}this.initPos();for(var n=0,o=this.weaknessRoot.children;n<o.length;n++){o[n].name=this.id}},t.prototype.initPos=function(){for(var e=cc.v2(0,0),t=0,n=this.animation.getClips();t<n.length;t++){var i=n[t];if(i&&i.name==this.initAni&&i.curveData.props&&i.curveData.props.position){e.x=i.curveData.props.position[0].value[0],e.y=i.curveData.props.position[0].value[1];break}}switch(this.monster.realMoveType){case o.FlyMove:this.flyMoveInit(e);break;case o.GroundMove:this.node.setPosition(e),this.play(this.initAni);break;case o.Static:this.node.setPosition(e),this.play(this.initAni),this.Spine.idle();break;case o.Teleport:this.getComponent(p.default).addPoint(e)}},t.prototype.flyMoveInit=function(e){this.node.setPosition(e),this.play(this.initAni),this.animation.on(cc.Animation.EventType.FINISHED,this.animationFinished,this)},t.prototype.play=function(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n=cc.WrapMode.Normal),void 0===o&&(o=0),console.log("play:"+e);var i=this;if(null===this.animation.getAnimationState(e))cc.loader.loadRes("Animation/Monster/"+this.monster.MonsterID+"/"+l.Game.sceneID+"/"+e,cc.AnimationClip,function(e,a){if(e)console.error(e);else{i.animation.addClip(a);var r=i.animation.play(a.name,t);r.wrapMode=n,r.speed=o>0?o:r.speed}});else{var a=this.animation.play(e,t);a.wrapMode=n,a.speed=o>0?o:a.speed}},t.prototype.animationFinished=function(){console.log(" -------------- animation finished ----------------"),this.play(this.moveAni,0,cc.WrapMode.Loop,this.monster.MoveSpeed)},t.prototype.checkMoveType_0=function(){switch(this.monster.MoveType){case a.Monster_ball__monster_type_1.FeiHangPingYi:this.monster.realMoveType=o.FlyMove;break;case a.Monster_ball__monster_type_1.GuDingWeiZhiBuDong:this.monster.realMoveType=o.Static;break;case a.Monster_ball__monster_type_1.LuDiPingYi:this.monster.realMoveType=o.GroundMove;break;case a.Monster_ball__monster_type_1.QuanTuShunYi:this.monster.realMoveType=o.Teleport}},t.prototype.checkMoveType_1=function(){switch(this.monster.MoveType){case a.Monster_ball__monster_type_2.FeiHangPingYi:this.monster.realMoveType=o.FlyMove;break;case a.Monster_ball__monster_type_2.GuDingWeiZhiBuDong:this.monster.realMoveType=o.Static;break;case a.Monster_ball__monster_type_2.LuDiPingYi:this.monster.realMoveType=o.GroundMove;break;case a.Monster_ball__monster_type_2.QuanTuShunYi:this.monster.realMoveType=o.Teleport}},t.prototype.checkMoveType_2=function(){switch(this.monster.MoveType){case a.Monster_ball__monster_type_3.FeiHangPingYi:this.monster.realMoveType=o.FlyMove;break;case a.Monster_ball__monster_type_3.GuDingWeiZhiBuDong:this.monster.realMoveType=o.Static;break;case a.Monster_ball__monster_type_3.LuDiPingYi:this.monster.realMoveType=o.GroundMove;break;case a.Monster_ball__monster_type_3.QuanTuShunYi:this.monster.realMoveType=o.Teleport}},__decorate([f(cc.Node)],t.prototype,"weaknessRoot",void 0),t=__decorate([u],t)}(cc.Component);n.default=m,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Game":"Game","../Game/Monster":"Monster","../table":"table","./MonsterSpine":"MonsterSpine","./TeleportMovement":"TeleportMovement"}],MonsterSpine:[function(e,t,n){"use strict";cc._RF.push(t,"91cc7aGeypK+J4TzKgkQw9C","MonsterSpine"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Game/Monster"),i=e("../Event/EventManager"),a=e("../Event/EventName"),r=e("../Game/Game"),s=e("../Game/BuffManager"),l=e("../Factory/GameFactory"),c=e("./MonsterCtrl"),p=cc._decorator,h=p.ccclass,u=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.monster=null,t.stage=0,t.motions=[],t}return __extends(t,e),t.prototype.reuse=function(){this.initEvent(),this.updateMonsterInfo(arguments[0][0],arguments[0][1])},t.prototype.unuse=function(){this.offEvent(),this.motions=[],this.stage=0,this.id=this.readID=null,this.monster=null},t.prototype.initEvent=function(){i.gEventMgr.on(a.GlobalEvent.MONSTER_ATTACK,this.attack,this),i.gEventMgr.on(a.GlobalEvent.MONSTER_HIT,this.hit,this),i.gEventMgr.on(a.GlobalEvent.MONSTER_DIE,this.die,this),i.gEventMgr.on(a.GlobalEvent.MONSTER_UPDATE_STAGE,this.updateStage,this),this.setCompleteListener(this.onComplete.bind(this))},t.prototype.offEvent=function(){i.gEventMgr.targetOff(this),this.setCompleteListener(null)},t.prototype.setAnimation=function(t,n,o){e.prototype.setAnimation.call(this,t,n,o),this.motions.push({name:n,loop:o}),this.motions.length>10&&this.motions.splice(0,this.motions.length-10)},t.prototype.normal=function(e){if(void 0===e&&(e=[]),this.monster)if(this.motions.length>0){for(var t=void 0;(t=this.motions.pop())&&e.indexOf(t.name)>=0;);t?this.setAnimation(0,t.name,t.loop):this.idle()}else this.idle()},t.prototype.idle=function(){this.monster&&""!=this.id&&"idle"!=this.animation&&this.monster.CanIdle&&this.setAnimation(0,"idle",!0)},t.prototype.move=function(){this.monster&&""!=this.id&&"move"!=this.animation&&(this.monster.realMoveType==c.MoveType.Teleport&&this.monster.setState(o.MonsterState.HIDE),this.setAnimation(0,"move",this.monster.realMoveType!=c.MoveType.Teleport))},t.prototype.attack=function(e){this.id==e&&(this.monster.setState(o.MonsterState.ATTACKING),"move"==this.animation&&this.motions.push({name:"move",loop:!1}),this.setAnimation(0,"attack",!1))},t.prototype.die=function(e){this.id==e&&(this.node.name="die fuck monster",this.setAnimation(0,"die",!1),this.id="",this.monster=null)},t.prototype.hit=function(e){this.id==e&&(this.onInterupt(this.animation),this.setAnimation(0,"hit",!1))},t.prototype.onInterupt=function(e){switch(e){case"attack":this.monster&&this.monster.delState(o.MonsterState.ATTACKING);break;case"die":l.gFactory.putMonster(this.readID,this.node);break;case"fly":case"idle":break;case"move":this.monster.realMoveType==c.MoveType.Teleport&&this.monster&&this.monster.delState(o.MonsterState.HIDE);break;case"hit":this.monster&&this.monster.delState(o.MonsterState.HIT)}},t.prototype.eventListener=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.log(e)},t.prototype.onComplete=function(e){var t=this;switch(e.animation.name){case"attack":this.monster.delState(o.MonsterState.ATTACKING),r.Game.addHp(-this.monster.Attack),this.idle();var n={name:"\u50f5\u76f4",type:s.BuffType.STIFF,handler:function(){t.monster.setState(o.MonsterState.STIFF)},completeHandler:function(){t.monster&&t.monster.delState(o.MonsterState.STIFF)},isOnce:!0,isImmediately:!0,duration:0,lastTime:1e3*this.monster.StiffTime,target:this,isCover:!0};this.monster&&this.monster.buff.addBuff(n),i.gEventMgr.emit(a.GlobalEvent.MONSTER_ATTACK_DONE);break;case"die":l.gFactory.putMonster(this.readID,this.node);break;case"fly":case"idle":break;case"move":this.monster.realMoveType==c.MoveType.Teleport&&this.monster&&this.monster.delState(o.MonsterState.HIDE);break;case"hit":this.monster&&this.monster.delState(o.MonsterState.HIT)}},t.prototype.updateMonsterInfo=function(e,t){this.id=e,this.readID=t.MonsterID.toString(),this.monster=t,this.stage=this.monster.Stage},t.prototype.updateStage=function(){this.monster&&(this.stage=this.monster.Stage)},t.prototype.start=function(){this.idle()},t.prototype.update=function(t){(this.monster||"die fuck monster"==this.node.name)&&(this.monster&&this.monster.State&o.MonsterState.NUMB||e.prototype.update.call(this,t))},t.prototype.onDestroy=function(){console.log(" Monster Spine Destroy!!!!!!!")},t=__decorate([h],t)}(sp.Skeleton));n.default=u,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Factory/GameFactory":"GameFactory","../Game/BuffManager":"BuffManager","../Game/Game":"Game","../Game/Monster":"Monster","./MonsterCtrl":"MonsterCtrl"}],Monster:[function(e,t,n){"use strict";cc._RF.push(t,"65415PJrYdEEpruhESUj1Op","Monster"),Object.defineProperty(n,"__esModule",{value:!0});var o,i=e("../TableMgr"),a=e("../Event/EventName"),r=e("./BuffManager"),s=e("../Event/EventManager");(function(e){e[e.NORMAL=2]="NORMAL",e[e.STIFF=4]="STIFF",e[e.HIT=8]="HIT",e[e.DIE=16]="DIE",e[e.NUMB=32]="NUMB",e[e.INVINCIBLE=64]="INVINCIBLE",e[e.HIDE=128]="HIDE",e[e.ATTACKING=256]="ATTACKING",e[e.RELAX=512]="RELAX"})(o=n.MonsterState||(n.MonsterState={}));var l,c=o.DIE|o.HIT|o.NUMB|o.STIFF|o.ATTACKING|o.RELAX,p=o.DIE|o.HIT|o.NUMB|o.STIFF|o.HIDE|o.ATTACKING,h=o.DIE|o.HIT|o.NUMB|o.HIDE|o.ATTACKING;(function(e){e[e.STAGE_0=1]="STAGE_0",e[e.STAGE_1=2]="STAGE_1",e[e.STAGE_2=3]="STAGE_2"})(l=n.MonsterStage||(n.MonsterStage={})),function(e){e[e.P_1=1]="P_1",e[e.P_2=2]="P_2",e[e.P_3=3]="P_3"}(n.Birth_Point||(n.Birth_Point={}));var u=function(){function e(e){this.state=o.NORMAL,this.monsterID=e,this.stage=l.STAGE_0,this.monsterStaticData=i.TableMgr.inst.getMonster_ball__monster(this.monsterID),this.type=this.monsterStaticData.monster,this.updatePro(),this.buff=new r.BuffManager(this.monsterID)}return e.prototype.updatePro=function(){this.attackTime=0,this.resetState(),this.curHp=this.monsterStaticData["hp_"+this.stage],this.totalHp=this.curHp,this.attackSpeed=this.monsterStaticData["hz_"+this.stage],this.moveSpeed=this.monsterStaticData["speed_"+this.stage],this.moveType=this.monsterStaticData["type_"+this.stage],this.attack=this.monsterStaticData["attack_"+this.stage],this.stiffTime=this.monsterStaticData.interval},e.prototype.resetState=function(){this.state=o.NORMAL},Object.defineProperty(e.prototype,"State",{get:function(){return this.state},enumerable:!0,configurable:!0}),e.prototype.setState=function(e){this.state&e||(this.state|=e)},e.prototype.delState=function(e){this.state&e?this.state&=65535^e:console.warn(" \u6ca1\u6709\u8be5\u72b6\u6001:"+o[e])},Object.defineProperty(e.prototype,"StiffTime",{get:function(){return this.stiffTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MonsterID",{get:function(){return this.monsterID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Attack",{get:function(){return this.attack},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MoveType",{get:function(){return this.moveType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"MoveSpeed",{get:function(){return this.moveSpeed},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Score",{get:function(){return this.monsterStaticData.score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Stage",{get:function(){return this.stage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Invincible",{get:function(){return this.state&o.INVINCIBLE},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanMove",{get:function(){return!(this.state&c)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanAttack",{get:function(){return!(this.state&p)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CanIdle",{get:function(){return!(this.state&h)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Name",{get:function(){return this.monsterStaticData.name},enumerable:!0,configurable:!0}),e.prototype.addHp=function(e){return this.curHp+=e,console.log("\u602a\u517d:"+this.MonsterID+"\u88ab\u653b\u51fb:"+e+",curHp:"+this.curHp),!(this.curHp<=0)||!!this.checkStage()&&(this.stage++,this.updatePro(),s.gEventMgr.emit(a.GlobalEvent.MONSTER_UPDATE_STAGE),!0)},e.prototype.checkStage=function(){var e=this.stage+1;return this.monsterStaticData["hp_"+e]&&this.monsterStaticData["attack_"+e]&&this.monsterStaticData["hz_"+e]&&this.monsterStaticData["type_"+e]&&this.monsterStaticData["speed_"+e]},e.prototype.checkCanAttack=function(e){return!!this.CanAttack&&(this.attackTime+=e,this.attackTime>=this.attackSpeed&&(this.attackTime=0,!0))},e.prototype.update=function(e,t){this.checkCanAttack(e)&&s.gEventMgr.emit(a.GlobalEvent.MONSTER_ATTACK,t),this.buff.update(e)},e}();n.Monster=u,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../TableMgr":"TableMgr","./BuffManager":"BuffManager"}],OverLayer:[function(e,t,n){"use strict";cc._RF.push(t,"ccbfcmg50JNpaiViKnXy98B","OverLayer"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../TableMgr"),i=e("../Game/Game"),a=cc._decorator,r=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.Level=null,t.Quit=null,t.Score=null,t.LevelCross=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.Quit.target.on(cc.Node.EventType.TOUCH_END,function(){cc.game.restart()},this);var e=o.TableMgr.inst.getAll_Monster_ball_evaluate_Data(),t=i.Game.totalScore,n="1";for(var a in e){if(t<e[a].min)break;n=a}var r=this;this.Level.enabled=!1,cc.loader.loadRes("Texture/OverLayer/bg_battleover_"+e[n].evaluate,cc.SpriteFrame,function(e,t){e?(console.error(e),r.Level.node.active=!1):(r.Level.enabled=!0,r.Level.spriteFrame=t)}),this.Score.string=t.toString(),this.LevelCross.string=i.Game.level.toString()},t.prototype.start=function(){},__decorate([s(cc.Sprite)],t.prototype,"Level",void 0),__decorate([s(cc.Button)],t.prototype,"Quit",void 0),__decorate([s(cc.Label)],t.prototype,"Score",void 0),__decorate([s(cc.Label)],t.prototype,"LevelCross",void 0),t=__decorate([r],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../Game/Game":"Game","../TableMgr":"TableMgr"}],OverScene:[function(e,t,n){"use strict";cc._RF.push(t,"53e47P/BpVLeoOB8uulsdo3","OverScene"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./BaseScene"),i=e("../Shader/ShaderManager"),a=cc._decorator,r=a.ccclass,s=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t}return __extends(t,e),t.prototype.onLoad=function(){i.ShaderManager.inst},t.prototype.start=function(){this.node.on(cc.Node.EventType.TOUCH_END,function(){cc.game.restart()})},t.prototype.setLabel=function(e){this.label.string=e},__decorate([s(cc.Label)],t.prototype,"label",void 0),t=__decorate([r],t)}(o.default);n.default=l,cc._RF.pop()},{"../Shader/ShaderManager":"ShaderManager","./BaseScene":"BaseScene"}],ShaderManager:[function(e,t,n){"use strict";cc._RF.push(t,"c4d6fndbe5Ef5yjK0EAjTVc","ShaderManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ShaderTemplate"),i=cc.renderer.renderEngine,a=i.Material,r=i.renderer,s=i.gfx,l=function(){function e(){var e=cc.renderer._forward._programLib;if(e)for(var t=0,n=o.templates;t<n.length;t++){var i=n[t];e._templates[i.name]||e.define(i.name,i.vert,i.frag,i.defines)}else console.error("programLib not exist!")}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e}();n.ShaderManager=l;var c=function(e){function t(){var t=e.call(this)||this;t.time=0,t.range=.1;var n=new r.Pass("transition_sprite");n.setDepth(!1,!1),n.setCullMode(s.CULL_NONE),n.setBlend(s.BLEND_FUNC_ADD,s.BLEND_SRC_ALPHA,s.BLEND_ONE_MINUS_SRC_ALPHA,s.BLEND_FUNC_ADD,s.BLEND_SRC_ALPHA,s.BLEND_ONE_MINUS_SRC_ALPHA);var o=new r.Technique(["transparent"],[{name:"texture",type:r.PARAM_TEXTURE_2D},{name:"color",type:r.PARAM_COLOR4},{name:"time",type:r.PARAM_FLOAT},{name:"range",type:r.PARAM_FLOAT}],[n]);return t._color={r:1,g:1,b:1,a:1},t._effect=new r.Effect([o],{color:t._color,time:t.time,range:t.range},[{name:"useTexture",value:!0},{name:"useModel",value:!1},{name:"useColor",value:!0}]),t._mainTech=o,t._texture=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"effect",{get:function(){return this._effect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._effect.setProperty("texture",e.getImpl()),this._texIds.texture=e.getId())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useModel",{get:function(){return this._effect.getDefine("useModel")},set:function(e){this._effect.define("useModel",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useTexture",{get:function(){return this._effect.getDefine("useTexture")},set:function(e){this._effect.define("useTexture",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useColor",{get:function(){return this._effect.getDefine("useColor")},set:function(e){this._effect.define("useColor",e)},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){this._effect.setProperty(e,t)},t.prototype.clone=function(){var e=new t;return e._mainTech.copy(this._mainTech),e.texture=this.texture,e.useTexture=this.useTexture,e.useModel=this.useModel,e.useColor=this.useColor,e.updateHash(),e},t}(a);n.TransitionMaterial=c;var p=function(e){function t(){var t=e.call(this)||this;t.time=0,t.range=2,t.deltaTime=0;var n=new r.Pass("wave_sprite");n.setDepth(!1,!1),n.setCullMode(s.CULL_NONE),n.setBlend(s.BLEND_FUNC_ADD,s.BLEND_SRC_ALPHA,s.BLEND_ONE_MINUS_SRC_ALPHA,s.BLEND_FUNC_ADD,s.BLEND_SRC_ALPHA,s.BLEND_ONE_MINUS_SRC_ALPHA);var o=new r.Technique(["transparent"],[{name:"texture",type:r.PARAM_TEXTURE_2D},{name:"color",type:r.PARAM_COLOR4},{name:"time",type:r.PARAM_FLOAT},{name:"deltaTime",type:r.PARAM_FLOAT},{name:"range",type:r.PARAM_FLOAT}],[n]);return t._color={r:1,g:1,b:1,a:1},t._effect=new r.Effect([o],{color:t._color,time:t.time,range:t.range,deltaTime:t.deltaTime},[{name:"useTexture",value:!0},{name:"useModel",value:!1},{name:"useColor",value:!0}]),t._mainTech=o,t._texture=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"effect",{get:function(){return this._effect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture=e,this._effect.setProperty("texture",e.getImpl()),this._texIds.texture=e.getId())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useModel",{get:function(){return this._effect.getDefine("useModel")},set:function(e){this._effect.define("useModel",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useTexture",{get:function(){return this._effect.getDefine("useTexture")},set:function(e){this._effect.define("useTexture",e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"useColor",{get:function(){return this._effect.getDefine("useColor")},set:function(e){this._effect.define("useColor",e)},enumerable:!0,configurable:!0}),t.prototype.setProperty=function(e,t){this._effect.setProperty(e,t)},t.prototype.clone=function(){var e=new c;return e._mainTech.copy(this._mainTech),e.texture=this.texture,e.useTexture=this.useTexture,e.useModel=this.useModel,e.useColor=this.useColor,e.updateHash(),e},t}(a);n.WaveMaterial=p,cc._RF.pop()},{"./ShaderTemplate":"ShaderTemplate"}],ShaderTemplate:[function(e,t,n){"use strict";cc._RF.push(t,"201c4JgGAhL0JiWCcaco4XQ","ShaderTemplate"),Object.defineProperty(n,"__esModule",{value:!0}),n.templates=[{name:"transition_sprite",vert:"\n    uniform mat4 viewProj;\n    attribute vec3 a_position;\n    attribute lowp vec4 a_color;\n    varying mediump vec4 v_pos;\n    #ifdef useModel \n        uniform mat4 model;\n    #endif\n    #ifdef useTexture\n        attribute mediump vec2 a_uv0;  \n        varying mediump vec2 uv0;\n    #endif\n    #ifndef useColor \n        varying lowp vec4 v_fragmentColor;\n    #endif\n    void main () {\n        mat4 mvp;\n        #ifdef useModel\n             mvp = viewProj * model;\n        #else\n             mvp = viewProj;  \n        #endif  \n        vec4 pos = mvp * vec4(a_position, 1);\n        #ifndef useColor\n             v_fragmentColor = a_color;\n        #endif\n        #ifdef useTexture    \n             uv0 = a_uv0;  \n        #endif  \n        v_pos = pos;\n        gl_Position = pos;\n    }",frag:"\n    uniform float time;\n    uniform float range;\n    varying mediump vec4 v_pos;\n    #ifdef useTexture  \n        uniform sampler2D texture;  \n        varying mediump vec2 uv0;\n    #endif\n    #ifdef useColor\n        uniform lowp vec4 color;\n    #else  \n        varying lowp vec4 v_fragmentColor;\n    #endif\n    void main () {  \n        #ifdef useColor    \n             vec4 o = color;\n        #else\n             vec4 o = v_fragmentColor;  \n        #endif  \n        #ifdef useTexture    \n             o *= texture2D(texture, uv0); \n             if (uv0.x <= time) {\n                float factor = time - uv0.x;\n                if (factor > range) o.w *= 0.0;\n                else o.w *= (1.0-factor/range);\n                \n            } else {\n                o.w *=  1.0;\n            }\n        #else\n            float px = v_pos.x + 1.0;\n            if (px <= time*2.0) {\n                float factor = time*2.0 - px;\n                if (factor > range) o.w *= 0.0;\n                else o.w *= (1.0-factor/range);\n            } else {\n                o.w *=  1.0;\n            }\n        #endif  \n        \n        gl_FragColor = o;\n    }",defines:[{name:"useModel"},{name:"useTexture"},{name:"useColor"}]},{name:"wave_sprite",vert:"\n    uniform float time;\n    uniform float deltaTime;\n    varying float v_time;\n    varying float v_deltaTime;\n    uniform mat4 viewProj;\n    attribute vec3 a_position;\n    attribute lowp vec4 a_color;\n    #ifdef useModel \n        uniform mat4 model;\n    #endif\n    #ifdef useTexture\n        attribute mediump vec2 a_uv0;  \n        varying mediump vec2 uv0;\n    #endif\n    #ifndef useColor \n        varying lowp vec4 v_fragmentColor;\n    #endif\n    void main () {\n        mat4 mvp;\n        #ifdef useModel\n             mvp = viewProj * model;\n        #else\n             mvp = viewProj;  \n        #endif  \n        vec4 pos = mvp * vec4(a_position, 1);\n        #ifndef useColor\n             v_fragmentColor = a_color;\n        #endif\n        #ifdef useTexture    \n             uv0 = a_uv0;  \n        #endif  \n        v_time = time;\n        v_deltaTime = deltaTime;\n        gl_Position = pos;\n    }",frag:"\n    varying float v_time;\n    varying float v_deltaTime;\n    #ifdef useTexture  \n        uniform sampler2D texture;  \n        varying mediump vec2 uv0;\n    #endif\n    #ifdef useColor\n        uniform lowp vec4 color;\n    #else  \n        varying lowp vec4 v_fragmentColor;\n    #endif\n    void main () {  \n        #ifdef useColor    \n             vec4 o = color;\n        #else\n             vec4 o = v_fragmentColor;  \n        #endif  \n        #ifdef useTexture    \n             vec2 uv_temp = uv0;\n             uv_temp.y += uv_temp.x*(sin(v_deltaTime + v_time) - sin(v_time));\n             o *= texture2D(texture, uv_temp); \n        #endif  \n        \n        gl_FragColor = o;\n    }",defines:[{name:"useModel"},{name:"useTexture"},{name:"useColor"}]}],cc._RF.pop()},{}],TableMgr:[function(e,t,n){"use strict";cc._RF.push(t,"25685du2JVGR48ndlFQxrEJ","TableMgr"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this.total=0,this.complete=0,this.Monster_ball__monster={},this.Monster_ball_ball={},this.Monster_ball_evaluate={},this.Monster_ball_paly_level={},this.Monster_ball_prop={},this.Monster_ball_scene={}}return Object.defineProperty(e,"inst",{get:function(){return this.ins?this.ins:this.ins=new e},enumerable:!0,configurable:!0}),e.prototype.startLoad=function(e,t,n){this.completeCallback=t,this.progressCallback=n;var o=this;cc.loader.loadRes(e.trim().split("/").join("")+"/file_list",cc.JsonAsset,function(t,n){if(t)console.error(t);else{this.total=n.json.length;for(var i=0,a=n.json;i<a.length;i++){var r=a[i];o.loadJson(e.trim().split("/").join("")+"/"+r.replace(".json",""))}}}.bind(this))},e.prototype.loadJson=function(e){console.log("start load:"+e);var t=this;cc.loader.loadRes(e,cc.JsonAsset,function(e,n){if(e)console.error(e);else{for(var o=0,i=n.json;o<i.length;o++){var a=i[o];t[n.name][a.ID]=a}t.completeLoad()}}.bind(this))},e.prototype.completeLoad=function(){this.complete++,this.complete>=this.total&&this.completeCallback&&this.completeCallback()},e.prototype.getMonster_ball__monster=function(e){return this.Monster_ball__monster[e]?this.Monster_ball__monster[e]:(console.error("Monster_ball__monster \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Monster_ball__monster_Data=function(){return this.Monster_ball__monster},e.prototype.getMonster_ball_ball=function(e){return this.Monster_ball_ball[e]?this.Monster_ball_ball[e]:(console.error("Monster_ball_ball \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Monster_ball_ball_Data=function(){return this.Monster_ball_ball},e.prototype.getMonster_ball_evaluate=function(e){return this.Monster_ball_evaluate[e]?this.Monster_ball_evaluate[e]:(console.error("Monster_ball_evaluate \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Monster_ball_evaluate_Data=function(){return this.Monster_ball_evaluate},e.prototype.getMonster_ball_paly_level=function(e){return this.Monster_ball_paly_level[e]?this.Monster_ball_paly_level[e]:(console.error("Monster_ball_paly_level \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Monster_ball_paly_level_Data=function(){return this.Monster_ball_paly_level},e.prototype.getMonster_ball_prop=function(e){return this.Monster_ball_prop[e]?this.Monster_ball_prop[e]:(console.error("Monster_ball_prop \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Monster_ball_prop_Data=function(){return this.Monster_ball_prop},e.prototype.getMonster_ball_scene=function(e){return this.Monster_ball_scene[e]?this.Monster_ball_scene[e]:(console.error("Monster_ball_scene \u4e0d\u5b58key\uff1a"+e),null)},e.prototype.getAll_Monster_ball_scene_Data=function(){return this.Monster_ball_scene},e}();n.TableMgr=o,cc._RF.pop()},{}],TeleportMovement:[function(e,t,n){"use strict";cc._RF.push(t,"5e6c2gIX6pDwbna9tCpyw+h","TeleportMovement"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Game/Monster"),i=e("../Event/EventManager"),a=e("../Event/EventName"),r=e("./MonsterSpine"),s=e("./MonsterCtrl"),l=e("../table"),c=cc._decorator,p=c.ccclass,h=(c.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.monster=null,t.stage=0,t.moveCD=0,t.telePoint=[cc.v2(-591,225),cc.v2(-253,608),cc.v2(645,290),cc.v2(401,103)],t.curTelePoint=[],t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.reuse=function(){i.gEventMgr.on(a.GlobalEvent.MONSTER_DIE,this.die,this),this.updateMonsterInfo(arguments[0][0],arguments[0][1]),this.node.zIndex=-100},t.prototype.unuse=function(){i.gEventMgr.targetOff(this),this.monster=null,this.id=this.readID="",this.stage=0},t.prototype.addPoint=function(e){for(var t=!0,n=0,o=this.telePoint;n<o.length;n++){var i=o[n];if(CMath.Distance(i,e)<10){t=!1;break}}t&&this.telePoint.push(e),this.curTelePoint=this.telePoint.concat(),console.log(this.telePoint)},t.prototype.start=function(){},t.prototype.die=function(e){this.id==e&&(this.monster=null)},Object.defineProperty(t.prototype,"Spine",{get:function(){return this.spine?this.spine:this.spine=this.getComponent(r.default)},enumerable:!0,configurable:!0}),t.prototype.updateMonsterInfo=function(e,t){this.id=e,this.readID=t.MonsterID.toString(),this.monster=t,this.stage=this.monster.Stage,this.enabled=this.monster.realMoveType==s.MoveType.Teleport&&this.monster.Type!=l.Monster_ball__monster_monster.BOSS},t.prototype.update=function(e){this.monster&&(this.monster.State&o.MonsterState.NUMB||(this.moveCD+=e,this.moveCD>=this.monster.StiffTime&&this.monster.CanMove?(this.moveCD=0,this.Spine.move(),setTimeout(this.move.bind(this),600)):this.Spine.idle()))},t.prototype.move=function(){var e=cc.director.getTotalFrames()%this.curTelePoint.length;this.node.setPosition(this.curTelePoint.splice(e,1)[0]),this.node.scaleX=this.node.x>0?1:-1,0==this.curTelePoint.length&&(this.curTelePoint=this.telePoint.concat()),console.log(this.curTelePoint)},t=__decorate([p],t)}(cc.Component));n.default=h,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","../Game/Monster":"Monster","../table":"table","./MonsterCtrl":"MonsterCtrl","./MonsterSpine":"MonsterSpine"}],TransitionMask:[function(e,t,n){"use strict";cc._RF.push(t,"62af3eKgRRIeIqN2zIFLGIM","TransitionMask"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ShaderManager"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transitionMaterial=new o.TransitionMaterial,t.startTrans=!1,t.time=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this.getComponent(cc.Mask);e._material=this.transitionMaterial,e._activateMaterial(),this.transitionMaterial.setProperty("range",.1)},t.prototype.start=function(){},t.prototype.update=function(e){this.startTrans&&(this.time+=1.2*e,this.transitionMaterial.setProperty("time",this.time))},t=__decorate([a],t)}(cc.Component));n.default=r,cc._RF.pop()},{"./ShaderManager":"ShaderManager"}],TransitionSprite:[function(e,t,n){"use strict";cc._RF.push(t,"21b9bI2CjxK8rInGsLpCraP","TransitionSprite"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ShaderManager"),i=e("../Event/EventManager"),a=e("../Event/EventName"),r=cc._decorator,s=r.ccclass,l=(r.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transitionMaterial=new o.TransitionMaterial,t.time=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this.getComponent(cc.Sprite);e._spriteMaterial=this.transitionMaterial,e._activateMaterial(),this.transitionMaterial.setProperty("range",.1)},t.prototype.start=function(){},t.prototype.update=function(e){this.node.active?(this.Time+=.8*e,this.time>2&&(this.Time=0,this.node.active=!1,i.gEventMgr.emit(a.GlobalEvent.ADD_NEW_MONSTER))):this.Time=0},Object.defineProperty(t.prototype,"Time",{get:function(){return this.time},set:function(e){this.time=e,this.transitionMaterial.setProperty("time",this.time)},enumerable:!0,configurable:!0}),t=__decorate([s],t)}(cc.Component));n.default=l,cc._RF.pop()},{"../Event/EventManager":"EventManager","../Event/EventName":"EventName","./ShaderManager":"ShaderManager"}],WaveSprite:[function(e,t,n){"use strict";cc._RF.push(t,"8b316Iw6W5OFqaeK8iUMK9S","WaveSprite"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ShaderManager"),i=cc._decorator,a=i.ccclass,r=(i.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.wave=new o.WaveMaterial,t.time=0,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this.getComponent(cc.Sprite);e._spriteMaterial=this.wave,e._activateMaterial(),this.wave.setProperty("range",1)},t.prototype.start=function(){},t.prototype.update=function(e){this.time+=10*e,this.wave.setProperty("time",this.time),this.wave.setProperty("deltaTime",e)},t=__decorate([a],t)}(cc.Component));n.default=r,cc._RF.pop()},{"./ShaderManager":"ShaderManager"}],Weakness:[function(e,t,n){"use strict";cc._RF.push(t,"2d081m50EpBtb8U+/H/IVeC","Weakness"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../Event/EventManager"),i=e("../Event/EventName"),a=e("../Config/Config"),r=cc._decorator,s=r.ccclass,l=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.spine=null,t.followBone="",t.bone=null,t.initBone={worldX:0,worldY:0,rotation:0},t}return __extends(t,e),t.prototype.onLoad=function(){o.gEventMgr.on(i.GlobalEvent.PLANE_ATTACK_DONE,this.addBoom,this)},t.prototype.unLoad=function(){o.gEventMgr.targetOff(this)},t.prototype.addBoom=function(){this.node&&this.node.active&&this.node.isValid&&this.node.parent&&this.node.parent.isValid&&this.node.parent.active&&setTimeout(function(){this.node&&this.node.isValid&&this.node.parent&&this.node.parent.isValid&&this.node.parent.active&&o.gEventMgr.emit(i.GlobalEvent.ADD_EFFECT,a.EffectType.Boom,this.node.parent.convertToWorldSpaceAR(this.node.position),!1)}.bind(this),1500*Math.random())},t.prototype.start=function(){this.pos=cc.v2(this.node.position.x,this.node.position.y),this.spine&&""!=this.followBone&&(this.spine.updateWorldTransform(),this.bone=this.spine.findBone(this.followBone))},t.prototype.update=function(e){this.node&&this.node.active&&this.node.isValid&&this.node.parent&&this.node.parent.isValid&&this.node.parent.active&&(this.node.setPosition(this.pos),this.bone&&(0==this.initBone.worldX&&0==this.initBone.worldY&&(this.initBone.worldX=this.bone.worldX,this.initBone.worldY=this.bone.worldY,this.initBone.rotation=this.bone.rotation),this.node.x+=this.bone.worldX-this.initBone.worldX,this.node.y+=this.bone.worldY-this.initBone.worldY,this.node.rotation=this.bone.rotation-this.initBone.rotation))},t.prototype.onDestroy=function(){o.gEventMgr.targetOff(this)},__decorate([l(sp.Skeleton)],t.prototype,"spine",void 0),__decorate([l],t.prototype,"followBone",void 0),t=__decorate([s],t)}(cc.Component);n.default=c,cc._RF.pop()},{"../Config/Config":"Config","../Event/EventManager":"EventManager","../Event/EventName":"EventName"}],WelcomeScene:[function(e,t,n){"use strict";cc._RF.push(t,"eb0baSzE0ZOwI4WnZ36jDbT","WelcomeScene"),Object.defineProperty(n,"__esModule",{value:!0});var o,i=e("./BaseScene"),a=e("../Utils/HashMap"),r=e("../Config/Config"),s=e("../TableMgr"),l=e("../Shader/ShaderManager"),c=e("../Factory/GameFactory"),p=e("../Controller/AudioController"),h=cc._decorator,u=h.ccclass,f=h.property;(function(e){e[e.READY=2]="READY",e[e.INIT=4]="INIT",e[e.REGISTER=8]="REGISTER",e[e.LOGIN=16]="LOGIN",e[e.MATCH=32]="MATCH",e[e.JSON_PARSE=64]="JSON_PARSE",e[e.ANIMATION_DONE=128]="ANIMATION_DONE",e[e.SCENE_DONE=256]="SCENE_DONE",e[e.AUDIO=512]="AUDIO",e[e.DONE=1022]="DONE"})(o=n.LOAD_STEP||(n.LOAD_STEP={}));var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nextSceneName="Game",t.loadingPercent=null,t.Tip=null,t.percentLabel=null,t._callbacks=new a.HashMap,t._step=o.READY,t}return __extends(t,e),t.prototype.onLoad=function(){var e=this;l.ShaderManager.inst,cc.game.setFrameRate(30),this.defaultAnimation=this.node.getComponent(cc.Animation),this.defaultAnimation?this.defaultAnimation.once(cc.Animation.EventType.FINISHED,this.animationDone,this):this.nextStep(o.ANIMATION_DONE),r.Config.isMultiPlayer||(this.nextStep(o.LOGIN),this.nextStep(o.MATCH),this.nextStep(o.REGISTER),this.nextStep(o.INIT)),s.TableMgr.inst.startLoad("json/",function(){c.gFactory.init(function(){this.nextStep(o.JSON_PARSE)}.bind(e))}),p.gAudio.init(function(){this.nextStep(o.AUDIO)}.bind(this)),cc.director.preloadScene(this.nextSceneName,null,function(t,n){t?console.error("\u573a\u666f\u52a0\u8f7d\u9519\u8bef"):(e.nextScene=n.scene,e.nextStep(o.SCENE_DONE))})},t.prototype.animationDone=function(){this.defaultAnimation.off(cc.Animation.EventType.FINISHED),this.nextStep(o.ANIMATION_DONE)},t.prototype.registerStep=function(e,t){this._callbacks.add(e,t)},t.prototype.nextStep=function(e){this._step|=e,console.log("CUR STEP:"+o[e]+", total: "+this._step),this.loadingPercent.progress=this._step/o.DONE,this.percentLabel.string=(this._step/o.DONE*100).toFixed(2)+"%",this._step>=o.DONE?this.nextScene?(console.log("runSceneImmediate"),cc.director.runSceneImmediate(this.nextScene)):cc.director.loadScene(this.nextSceneName):e==o.ANIMATION_DONE&&this.defaultAnimation&&(this._step&=65535^o.ANIMATION_DONE,this.defaultAnimation.once(cc.Animation.EventType.FINISHED,this.animationDone,this),this.defaultAnimation.play())},__decorate([f({displayName:"\u6e38\u620f\u573a\u666f\u540d",tooltip:"\u9ed8\u8ba4\u8fdb\u5165Game\u573a\u666f\uff0c\u5982\u679c\u9700\u8981\u6307\u5b9a\u573a\u666f\uff0c\u53ef\u4ee5\u6307\u5b9a"})],t.prototype,"nextSceneName",void 0),__decorate([f(cc.ProgressBar)],t.prototype,"loadingPercent",void 0),__decorate([f(cc.Label)],t.prototype,"Tip",void 0),__decorate([f(cc.Label)],t.prototype,"percentLabel",void 0),t=__decorate([u],t)}(i.default);n.default=m,cc._RF.pop()},{"../Config/Config":"Config","../Controller/AudioController":"AudioController","../Factory/GameFactory":"GameFactory","../Shader/ShaderManager":"ShaderManager","../TableMgr":"TableMgr","../Utils/HashMap":"HashMap","./BaseScene":"BaseScene"}],table:[function(e,t,n){"use strict";cc._RF.push(t,"fe7e46QRHJN1oi9gtz30zLf","table"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.XiaoGuai=1]="XiaoGuai",e[e.BOSS=2]="BOSS"}(n.Monster_ball__monster_monster||(n.Monster_ball__monster_monster={})),function(e){e[e.GuDingWeiZhiBuDong=1]="GuDingWeiZhiBuDong",e[e.LuDiPingYi=2]="LuDiPingYi",e[e.FeiHangPingYi=3]="FeiHangPingYi",e[e.QuanTuShunYi=4]="QuanTuShunYi"}(n.Monster_ball__monster_type_1||(n.Monster_ball__monster_type_1={})),function(e){e[e.LuDiPingYi=1]="LuDiPingYi",e[e.FeiHangPingYi=2]="FeiHangPingYi",e[e.QuanTuShunYi=3]="QuanTuShunYi",e[e.GuDingWeiZhiBuDong=4]="GuDingWeiZhiBuDong"}(n.Monster_ball__monster_type_2||(n.Monster_ball__monster_type_2={})),function(e){e[e.LuDiPingYi=1]="LuDiPingYi",e[e.FeiHangPingYi=2]="FeiHangPingYi",e[e.QuanTuShunYi=3]="QuanTuShunYi",e[e.GuDingWeiZhiBuDong=4]="GuDingWeiZhiBuDong"}(n.Monster_ball__monster_type_3||(n.Monster_ball__monster_type_3={})),function(e){e[e.PuTong=1]="PuTong",e[e.ZhaDan=2]="ZhaDan",e[e.DianJiMaBi=3]="DianJiMaBi"}(n.Monster_ball_ball_form||(n.Monster_ball_ball_form={})),function(e){e[e.PuTongGuanQia=1]="PuTongGuanQia",e[e.BOSSGuan=2]="BOSSGuan"}(n.Monster_ball_paly_level_form||(n.Monster_ball_paly_level_form={})),function(e){e[e.HuiFuNaiJiuDu=1]="HuiFuNaiJiuDu",e[e.QuanPingGongJiGuaiWu=2]="QuanPingGongJiGuaiWu",e[e.QuanBuGuaiWuTingDun=3]="QuanBuGuaiWuTingDun",e[e.JiaFenShu=4]="JiaFenShu"}(n.Monster_ball_prop_form||(n.Monster_ball_prop_form={})),cc._RF.pop()},{}]},{},["BallCtrl","Item","Config","AudioController","CameraController","Effect","EventManager","EventName","GameFactory","Ball","BuffManager","Game","Monster","BossZai","HorizontalMovement","MonsterCtrl","MonsterSpine","TeleportMovement","Weakness","Background","BaseScene","GameScene","OverScene","WelcomeScene","ShaderManager","ShaderTemplate","TransitionMask","TransitionSprite","WaveSprite","TableMgr","BallTab","MainUI","OverLayer","HashMap","table"]);